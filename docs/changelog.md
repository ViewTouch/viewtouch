# Changelog
All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/)


## [Unreleased]

### Fixed
- **Socket string safety and reliable writes (12-09-2025)**
  - Bounded all socket string reads with caller-provided buffer sizes to prevent overflows in terminal/server/printer links and truncate safely on oversized frames.
  - Propagated truncation errors from `GetString` to callers so terminal and printer string reads fail fast instead of returning partial data.
  - Hardened socket writes to retry partial writes (EINTR/EAGAIN) and fail cleanly on EPIPE, ensuring full headers/payloads are sent or the error is surfaced.
  - Zero-initialized item-name buffers during zone load and forced null termination to avoid stale data corrupting menu lookups.
  - Remote printer sockets now treat fd 0 as valid, use `sockaddr_un` correctly for bind/accept, and clean up descriptors reliably.
  - **Files modified**:
    - `src/network/remote_link.cc`
    - `src/network/remote_link.hh`
    - `term/term_view.cc`
    - `main/hardware/terminal.cc`
    - `main/hardware/remote_printer.cc`
- **Terminal socket correctness and cloning safety (12-09-2025)**
  - Treat only negative `accept()` results as errors so fd 0 connections are accepted; close the listener fd even when it is 0 to avoid descriptor leaks on minimal environments.
  - Set the clone terminal’s hostname instead of overwriting the source terminal, preserving the original peer identity when cloning.
  - **Files modified**: `main/hardware/terminal.cc`

### Changed
- **Build size and startup optimizations (12-09-2025)**
  - Default CMake build type now `RelWithDebInfo` to favor optimized binaries by default.
  - Added opt-in IPO/LTO and section GC flags to shrink binaries and speed load/link time; controllable via `-DVT_ENABLE_LTO` and `-DVT_GC_SECTIONS`.
  - Files modified:
    - `CMakeLists.txt`

### Removed
- **Page Variant System Removal (12-03-2025)**
  - **Removal**: Completely removed page variant functionality from the system
  - **Implementation**:
    - Removed `page_variant` field from `TermInfo` and `Terminal` classes
    - Removed "Default Page Variant" UI field from hardware configuration
    - Removed `FindByTerminalWithVariant()` function and replaced all calls with `FindByTerminal()`
    - Removed page variant read/write from settings file I/O
    - Removed `PageVariantName` and `PageVariantValue` label definitions
    - Simplified terminal initialization and page navigation code
  - **Impact**: System now uses simpler, direct terminal-to-page mapping without variant configuration. All terminals use their default page types.
  - **Files modified**:
    - `main/data/settings.hh` - Removed page_variant field from TermInfo
    - `main/data/settings.cc` - Removed page_variant initialization, read/write
    - `main/hardware/terminal.hh` - Removed page_variant field from Terminal
    - `main/hardware/terminal.cc` - Removed all page_variant logic, simplified page finding
    - `zone/hardware_zone.cc` - Removed page variant UI field
    - `zone/zone.cc` - Removed FindByTerminalWithVariant() function
    - `zone/zone.hh` - Removed FindByTerminalWithVariant() declaration
    - `main/ui/labels.cc` - Removed PageVariantName/PageVariantValue arrays
    - `main/ui/labels.hh` - Removed PageVariantName/PageVariantValue declarations

- **Company Sunwest Support Removal (12-03-2025)**
  - **Removal**: Removed all Sunwest-specific code and company option
  - **Implementation**:
    - Removed `STORE_SUNWEST` from company/store selection options
    - Removed Sunwest-specific media balance code
    - Removed Sunwest-specific navigation hacks in terminal and order zones
    - Removed Sunwest-specific entree count logic
  - **Impact**: System no longer includes Sunwest-specific functionality. All stores use standard behavior.
  - **Files modified**:
    - `main/data/settings.hh` - Removed STORE_SUNWEST definition
    - `main/data/settings.cc` - Removed STORE_SUNWEST from StoreName/StoreValue, removed Sunwest media balance code
    - `main/hardware/terminal.cc` - Removed Sunwest navigation hacks
    - `zone/order_zone.cc` - Removed Sunwest-specific entree logic
    - `main/business/check.cc` - Removed Sunwest comment

- **Kitchen/Bar Timer Toggle Removal (12-03-2025)**
  - **Removal**: Removed user-configurable toggle for kitchen/bar timers
  - **Implementation**:
    - Removed "Kitchen/Bar Timers" On/Off toggle from Kitchen section in Settings
    - Timer functionality remains enabled by default (setting still exists but is not user-configurable)
  - **Impact**: Kitchen/bar timers are always enabled. Users can no longer disable this feature.
  - **Files modified**:
    - `zone/settings_zone.cc` - Removed timer toggle UI field and LoadRecord/SaveRecord code

### Changed
- **Scalable Fonts Only + Toolbar Font Update (12-05-2025)**
  - **Change**: Removed all bitmap/core font fallbacks in font loading; Xft scalable fonts are now required. Updated the Edit Toolbar to use DejaVu Serif 24 Bold.
  - **Impact**: Consistent anti-aliased rendering across the UI; toolbar buttons render with larger, bold scalable text. Systems must have DejaVu Serif (or compatible) installed.
  - **Files modified**:
    - `term/term_view.cc`
    - `main/hardware/terminal.cc`
- **Edit Toolbar Size Enhancement (12-03-2025)**
  - **UI Enhancement**: Made edit toolbar and buttons wider for better usability
  - **Implementation**:
    - Increased toolbar width from 120 to 180 pixels (50% wider)
    - Increased button width from 60 to 90 pixels (50% wider)
    - Adjusted button positions to accommodate wider buttons
  - **Impact**: Edit toolbar is now more spacious and easier to use, with larger buttons that are easier to click.
  - **Files modified**:
    - `main/hardware/terminal.cc` - Updated toolbar and button dimensions

- **Self Order Terminal Configuration Simplification (12-03-2025)**
  - **UI Simplification**: Removed unnecessary "Default Page Variant" setting for Self Order terminals
  - **Implementation**:
    - Hidden page variant field when terminal type is Self Order (before complete removal)
  - **Impact**: Self Order terminal configuration is now simpler with fewer unnecessary options.
  - **Files modified**:
    - `zone/hardware_zone.cc` - Conditionally hide page variant field for Self Order terminals

### Fixed
- **SMTP child reaping and safer string handling (12-09-2025)**
  - Ensured SMTP helper processes are waited on to prevent zombie accumulation and pulled in the proper waitpid header.
  - Bounded `Terminal::ReplaceSymbols` output to the stack buffer size while preserving null termination to avoid overruns when expanding placeholders.
  - `POFile::Add` now returns a success flag after inserting entries so callers can detect successful additions.
  - **Files modified**:
    - `src/network/socket.cc`
    - `main/hardware/terminal.cc`
    - `main/data/locale.cc`
- **Safety and correctness fixes (12-09-2025)**
  - Hardened page reference rendering to prevent buffer overruns when many references are listed.
  - Restored accurate metric/imperial conversions for inventory units (grams/ml ↔ ounces) so changing units preserves amounts.
  - Made email iteration state per-instance (no shared statics), preventing cross-email corruption and allowing clean restarts.
  - **Files modified**:
    - `main/hardware/terminal.cc`
    - `main/business/inventory.cc`
    - `src/network/socket.hh`
    - `src/network/socket.cc`
- **Dialog menu buffer overflow and shutdown stability (12-05-2025)**
  - **Issue**: Dialog menus used `CompareList(int)` with a non-sentinel list, overrunning the value buffer and crashing in `DialogMenu::Set`. Shutdown could segfault removing Xt timeouts after the app context was destroyed. Item name array used `calloc` but was freed with `delete[]`, triggering allocator mismatches under ASan.
  - **Fix**: Bounded iteration over dialog value lists, guarded `XtRemoveTimeOut` when the Xt context is gone, and aligned ItemDB name array allocation/deallocation to `new[]`/`delete[]`.
  - **Files modified**:
    - `term/term_dialog.cc`
    - `term/term_view.cc`
    - `main/business/sales.cc`
- **Event loop stall logging (12-04-2025)**
  - **Issue**: ViewTouch could freeze/lock up after long runtimes with no clear trace.
  - **Fix**: Added watchdog logging in `UpdateSystemCB` to report when the main loop stalls (>3s gap) to aid diagnosis of future lockups.
  - **Impact**: Provides actionable logs to trace intermittent freezes without changing runtime behavior.
  - **Files modified**: `main/data/manager.cc`
- **CUPS/remote printer auto-recovery (12-04-2025)**
  - **Issue**: After idle periods, printing could hang due to lost CUPS/remote printer connections, requiring full app restart.
  - **Fix**: Added a reconnect hook to `Printer` and wired `RemotePrinter` to perform timed, non-blocking reconnection attempts when marked offline; the main loop now triggers reconnection during periodic printer health checks.
  - **Impact**: Remote printers can recover automatically without restarting ViewTouch when CUPS/socket links drop.
  - **Files modified**:
    - `main/hardware/printer.hh`
    - `main/hardware/remote_printer.cc`
    - `main/data/manager.cc`
- **End-of-day comment cleanup (12-04-2025)**
  - **Change**: Clarified `Terminal::EndDay` inline documentation to concisely describe the terminal-driven EOD loop and hand-off to `UpdateSystemCB()`.
  - **Impact**: Removes legacy note and keeps behavior description accurate for future maintainers.
  - **Files modified**: `main/hardware/terminal.cc`
- **Clang-tidy correctness and safety cleanups (12-04-2025)**
  - **Issue**: Sign conversions, unchecked indices, and C++ extensions triggered clang-tidy errors in core utilities and tracing.
  - **Fixes**:
    - Guarded X event/code lookups with signed bounds checks and size_t indexing.
    - Replaced variable-length stack trace buffer with std::vector and corrected backtrace symbol calls.
    - Hardened fntrace depth handling and string formatting utilities against signed/size mismatches.
    - Fixed snprintf format selection and size conversions in data file and time helpers; removed unused lambda capture in persistence manager.
    - Resolved forward declaration mismatch for `BatchItem` to avoid ABI warnings.
  - **Impact**: Clang-tidy now runs clean on core sources; safer bounds and size handling reduce UB risk.
  - **Files modified**:
    - `src/core/debug.cc`
    - `src/core/crash_report.cc`
    - `src/utils/fntrace.hh`
    - `src/utils/string_utils.hh`
    - `src/core/data_file.cc`
    - `src/core/data_persistence_manager.cc`
    - `src/core/time_info.cc`
    - `src/core/error_handler.cc`
    - `main/hardware/terminal.hh`
- **End-of-day stability guard (12-04-2025)**
  - **Issue**: End-of-day flow could dereference null terminals/system data, crashing the app when End Day was triggered.
  - **Fix**: Added null checks in `RunEndDay` and `Terminal::EndDay` before accessing system/settings, logging and aborting gracefully if unavailable; propagate System::EndDay failures to logs.
  - **Impact**: End-of-day requests no longer terminate the program if core pointers are missing; errors are logged instead.
  - **Files modified**:
    - `main/data/manager.cc`
    - `main/hardware/terminal.cc`
- **Index Page Lookup Bug (12-XX-2025)**
  - **Issue**: System was looking for Index page on hardcoded page 200 instead of using the proper Index page lookup mechanism
  - **Root Cause**: `Terminal::JumpToIndex()` function contained a problematic code block that jumped to hardcoded pages 200/206 based on check entree count, preventing the proper Index page lookup from executing
  - **Fix**: Removed the problematic code block that was jumping to hardcoded page numbers. The function now properly uses `FindByType(PAGE_INDEX, idx, size)` to find the correct Index page based on the index type parameter
  - **Impact**: After logging on and ordering, the system now correctly finds the Index page (e.g., page 60) instead of looking for non-existent page 200. Index page navigation now works correctly for all meal periods and index types
  - **Files modified**:
    - `main/hardware/terminal.cc` - Removed hardcoded page jump logic from `JumpToIndex()` function

- **Security and Code Quality Fixes from clang-tidy Analysis (12-02-2025)**
  - **Security Fixes**: Replaced insecure `strcat` calls with safe `vt_safe_string::safe_concat` functions
    - Fixed insecure string concatenation in `check.cc` (PaymentSummary and Description methods)
    - Fixed insecure string concatenation in `license_hash.cc` (MacToString function)
    - Fixed insecure string concatenation in `report_zone.cc` (ReadZone::Signal method)
  - **Format Security Fixes**: Fixed format string security issues in logging
    - Updated `logmsg` calls in `zone.cc` to use proper format strings (`"%s"`) instead of passing buffers directly
  - **Null Pointer Safety**: Added null checks to prevent potential crashes
    - Added null checks in `expense.cc` (Author method) for `term`, `term->system_data`, and `employee_name`
    - Added null checks in `table_zone.cc` (CustomerInfoZone::Signal) for `term` and `term->system_data` before dereferencing
  - **Dead Store Fixes**: Removed unused variable assignments and fixed return value bug
    - Removed unused `firstmod` assignment in `check.cc`
    - Fixed return value bug in `check.cc` (SubCheck::Write) - now properly returns error status instead of always returning 0
    - Removed unused `payptr` assignment in `check.cc` (NewPayment automatically adds payment)
  - **Impact**: Code is now more secure against buffer overflows, format string attacks, and null pointer dereferences. Dead code has been removed and a bug in error reporting has been fixed.
  - **Files modified**:
    - `main/business/check.cc` - Fixed insecure strcat calls, removed dead stores, fixed return value bug
    - `main/data/license_hash.cc` - Fixed insecure strcat/strncat calls
    - `zone/report_zone.cc` - Fixed insecure strcat call, added safe_string_utils include
    - `zone/zone.cc` - Fixed format-security issues in logmsg calls
    - `main/data/expense.cc` - Added null pointer checks
    - `zone/table_zone.cc` - Added null pointer checks

### Changed
- **Enhanced Embossed Text Rendering with Black Edges for Light Colors (12-XX-2025)**
  - **Visual Enhancement**: Added black edges on bottom and right for white and yellow text to improve contrast and readability
  - **Default Settings Update**: Changed embossed text default to enabled (Yes) for better text readability out of the box
  - **Implementation**:
    - Updated `GenericDrawStringXftEmbossed()` to detect white text (RGB >= 60000 for all components) and yellow text (RGB >= 60000 for red/green, blue < 1000)
    - White and yellow text now draw black edges at position (x+1, y+1) for bottom-right contrast
    - Black and dark brown text continue to use white embossed effect at (x+2, y+1)
    - Other colors maintain original top position (x, y-1) for consistency
  - **Impact**: White and yellow text now have better visibility with black edge contrast. Embossed text is enabled by default for improved readability across the interface.
  - **Files modified**:
    - `src/core/generic_char.cc` - Added black edge rendering for white/yellow text detection
    - `main/data/settings.cc` - Changed `use_embossed_text` default from 0 to 1
    - `term/term_view.cc` - Changed `use_embossed_text` default from 0 to 1

- **Index Tab Button Properties: Full Feature Parity with Simple Buttons (12-XX-2025)**
  - **Property Editor Enhancement**: Index Tab buttons now have access to all the same properties as Simple buttons in the editor dialog
  - **Implementation**:
    - Added `ZONE_INDEX_TAB` to image file selection visibility condition
    - Added `ZONE_INDEX_TAB` to jump type and jump ID visibility conditions
    - Added `ZONE_INDEX_TAB` to keyboard shortcut visibility condition
  - **Impact**: Index Tab buttons can now be configured with images, jump navigation, and keyboard shortcuts just like Simple buttons, providing complete feature parity in the editor interface
  - **Files modified**:
    - `term/term_dialog.cc` - Updated property visibility conditions to include ZONE_INDEX_TAB for image_filename, jump_type/jump_id, and key fields

- **Enhanced Embossed Text Rendering for Dark Colors (12-XX-2025)**
  - **Visual Enhancement**: Improved embossed text effect for black and dark brown text with widescreen-optimized positioning
  - **Implementation**: 
    - Updated `GenericDrawStringXftEmbossed()` to detect black text (RGB < 1000) and dark brown text (RGB ~{80, 45, 25})
    - Black and dark brown text now draw white embossed effect at position (x+2, y+1) for bottom-right highlight
    - Uses 2 pixels horizontal offset (instead of 1) to account for widescreen aspect ratios (almost 2:1 width to height)
    - Other colors maintain original top position (x, y-1) for consistency
  - **Impact**: Black and dark brown text with embossed effect now have better visual appearance with widescreen-optimized bottom-right highlight. Dark brown text (which was too dark) now has proper contrast with white embossing.
  - **Files modified**:
    - `src/core/generic_char.cc` - Modified embossed text rendering logic for black/dark brown detection and widescreen positioning

- **Color System Update: Replaced Light Blue with Dark Brown (12-XX-2025)**
  - **Color Replacement**: Replaced `COLOR_LT_BLUE` (light blue) with dark brown throughout the system
  - **Implementation**:
    - Updated `COLOR_LT_BLUE` RGB values from `{0, 120, 255}` to `{80, 45, 25}` (dark brown)
    - Updated shadow color from `{0, 0, 47}` to `{20, 10, 5}` for dark brown
    - Updated highlight color from `{218, 218, 240}` to `{180, 160, 140}` for dark brown
    - Changed UI label from "Light Blue" to "Dark Brown" in color selection menus
  - **Impact**: Light blue color option has been replaced with dark brown for better color palette consistency
  - **Files modified**:
    - `term/term_view.cc` - Updated COLOR_LT_BLUE color definitions in PenData array
    - `main/ui/labels.cc` - Changed "Light Blue" label to "Dark Brown"

### Added
- **Kitchen/Bar Timer Toggle Setting (12-03-2025)**
  - **Feature**: Added ability to enable/disable kitchen/bar timers in Settings page under Kitchen section
  - **Implementation**:
    - Added `enable_kitchen_bar_timers` setting (default: enabled/On) to control kitchen/bar timer functionality
    - Added "Kitchen/Bar Timers" On/Off toggle in Kitchen section of Settings page
    - Updated all timer-related code to check this setting before setting `chef_time` or displaying elapsed time
    - When disabled, timers will not start and elapsed time will not be displayed on kitchen video displays
  - **Impact**: Users can now control whether kitchen/bar timers are active, providing flexibility for different operational needs. Timers default to enabled for backward compatibility.
  - **Files modified**:
    - `main/data/settings.hh` - Added `enable_kitchen_bar_timers` field, updated SETTINGS_VERSION to 106
    - `main/data/settings.cc` - Added initialization, read/write logic for new setting
    - `zone/settings_zone.cc` - Added UI control in Kitchen section, updated LoadRecord/SaveRecord
    - `main/business/check.cc` - Updated FinalizeOrders(), Close(), PrintWorkOrder(), MakeReport() to check setting
    - `zone/report_zone.cc` - Updated GetDisplayCheck() to check setting

- **Automatic Crash Report Generation (12-02-2025)**
  - **Feature**: Automatic GDB-like crash report generation when ViewTouch crashes
  - **Implementation**:
    - Created crash reporting system that automatically generates detailed crash reports on fatal signals (SIGSEGV, SIGABRT, SIGBUS, SIGFPE, SIGILL, SIGQUIT)
    - Crash reports include: timestamp, signal information, full stack trace with demangled C++ function names, system information (OS, kernel, architecture), CPU information (model, frequency, cores), memory information (total/available), process information (PID, UID, working directory), environment variables, and build information
    - **Enhanced Crash Analysis**: Detailed signal code descriptions (SEGV_MAPERR, SEGV_ACCERR, etc.) explain the specific reason for crashes
    - **Memory Mapping Information**: Shows which memory region was accessed and its permissions for faulting addresses
    - **Recent Error Log**: Includes last 20 error log entries before crash for context
    - **Crash Analysis Section**: Explains what each signal type means and common causes (NULL pointer, use-after-free, buffer overflow, etc.)
    - Reports are automatically saved to `/usr/viewtouch/dat/crashreports/` with timestamped filenames
    - Directory is automatically created during installation and at runtime if needed
    - Works in both debug and release builds
    - Includes test function to trigger crashes for testing: `vt_main testcrash [segfault|abort|fpe|bus|ill]`
  - **Impact**: When ViewTouch crashes, detailed crash reports are automatically generated and saved, making it much easier to diagnose and fix issues. Reports now include comprehensive crash analysis explaining WHY the crash occurred, memory mapping information, recent error context, and detailed hardware/OS information to help identify environment-specific problems.
  - **Files modified**:
    - `src/core/crash_report.hh` - Crash reporting interface with siginfo support
    - `src/core/crash_report.cc` - Enhanced crash report generation with detailed signal analysis, memory mapping, error log integration, and crash analysis explanations. Fixed buffer initialization issue in memory mapping parser to prevent uninitialized memory access.
    - `main/data/manager.cc` - Integrated crash reporting into signal handlers and added test crash command
    - `CMakeLists.txt` - Added crash_report files to build and created crashreports directory during installation

- **AddressSanitizer and UndefinedBehaviorSanitizer Support (12-01-2025)**
  - **Runtime Memory Safety**: Added AddressSanitizer (ASan) and UndefinedBehaviorSanitizer (UBSan) support for debug builds
  - **Implementation**:
    - Added CMake option `ENABLE_SANITIZERS` (enabled by default for Debug builds)
    - Configured compiler flags: `-fsanitize=address,undefined -fno-omit-frame-pointer`
    - Automatically enabled when building with `-DCMAKE_BUILD_TYPE=Debug`
    - Can be disabled with `-DENABLE_SANITIZERS=OFF` if needed
  - **Memory Leak Fixes**: Fixed memory leaks in loader initialization code
    - Added proper cleanup for Xt widget (`XtDestroyWidget`) in `ExitLoader()`
    - Added proper cleanup for Xt application context (`XtDestroyApplicationContext`)
    - Ensured all Xft resources (draw, colors, fonts) are properly freed
    - Set pointers to nullptr after cleanup for safety
  - **Impact**: Debug builds now automatically catch runtime memory errors including:
    - Use-after-free, out-of-bounds reads/writes, double free, memory leaks
    - Integer overflow, invalid shifts, bad casts, undefined behavior
    - ViewTouch code is now leak-free; remaining leaks are from third-party system libraries (X11/Fontconfig)
  - **Files modified**:
    - `CMakeLists.txt` - Added sanitizer flags for Debug builds
    - `loader/loader_main.cc` - Fixed memory leaks in widget and application context cleanup

- **Index Tab Buttons for One-Touch Navigation (12-XX-2025)**
  - **Feature**: New Index Tab button type that enables one-touch navigation from any menu page to any other menu page
  - **Implementation**:
    - Created new `ZONE_INDEX_TAB` zone type (108) and `IndexTabZone` class extending `ButtonZone`
    - Index Tab buttons can only be created/edited on Index pages (PAGE_INDEX or PAGE_INDEX_WITH_TABS)
    - Menu Item pages automatically inherit and display Index Tab buttons from their parent Index page
    - Uses the existing `index` field relationship between Menu Item pages and Index pages (same mechanism as Order Flow button)
    - Modified `Page::Render()` to render Index Tab buttons from the matching Index page when rendering Menu Item pages
    - Updated `Page::FindZone()`, `Page::FindEditZone()`, and `Page::FindTranslateZone()` to handle Index Tab buttons on Menu Item pages
    - Added validation in `Page::Add()` to prevent Index Tab buttons from being added to non-Index pages
    - ViewTouch automatically ensures template page -94 exists for Index with Tabs (for all screen sizes)
    - ViewTouch automatically creates page 60 at 1920x1080 if it doesn't exist, using page -94 as a template when available
    - Uses exact size matching to ensure page 60 is only created at 1920x1080, not at smaller sizes
    - IndexTabZone now inherits all ButtonZone functionality (jump, image, colors, textures, frames) - works exactly like Simple buttons
    - Removed `AcceptSignals()` override so IndexTabZone uses same signal behavior as Simple buttons
  - **Impact**: Editors can now create Index Tab buttons on Index pages, and they will automatically appear on all Menu Item pages belonging to that Index, enabling users to navigate between any menu pages with a single touch. The system ensures a default Index page is always available at 1920x1080. Index Tab buttons now have full feature parity with Simple buttons.
  - **Files modified**:
    - `zone/pos_zone.hh` - Added ZONE_INDEX_TAB constant
    - `zone/button_zone.hh` - Added IndexTabZone class definition (removed AcceptSignals override for full ButtonZone compatibility)
    - `zone/button_zone.cc` - Implemented IndexTabZone class with CanSelect() and CanEdit() restrictions
    - `zone/pos_zone.cc` - Added IndexTabZone to zone creation
    - `zone/zone.cc` - Added Index Tab button rendering and zone finding for Menu Item pages, validation in Page::Add(), and auto-creation of pages 60 and -94
    - `main/ui/labels.cc` - Added "Index Tab" to zone type labels

- **Closed Check Report: Server Column Display (12-XX-2025)**
  - **Feature Enhancement**: Added Server column to Closed Check report to visually identify which server closed each check
  - **Implementation**:
    - Added "Server" column header at position 35 in the report header
    - Display server name for each closed check using `Check::WhoGetsSale()` to determine the server who gets credit for the sale
    - Server name is retrieved using `Terminal::UserName()` to display the employee's system name
  - **Impact**: Users can now easily identify which server closed each check when viewing Closed Check reports, making it easier to track server performance and sales attribution. The report now displays: Check#, Table, Guests, Amount, Payment, and Server.
  - **Files modified**:
    - `main/ui/system_report.cc` - Added Server column header and server name display in `ClosedCheckReportWorkFn()` and `System::ClosedCheckReport()`

### Fixed
- **Comprehensive Code Quality Improvements with clang-tidy (12-XX-2025)**
  - **Static Analysis Fixes**: Fixed 181 warnings and all critical errors across 10 major production files using clang-tidy
  - **Security Enhancements**:
    - Replaced 30+ insecure `strcat()` calls with `vt_safe_string::safe_concat()` to prevent buffer overflows
    - Fixed array comparison issues by using `strcmp()` instead of direct array address comparisons
    - Added null pointer checks to prevent dereference crashes in critical code paths
  - **Type Safety Improvements**:
    - Fixed 50+ implicit type conversions with explicit casts (int to short, size_t to int, float to double)
    - Fixed sign conversion warnings with proper type casting
    - Added explicit casts for `Cardinal`, `Uchar`, and other type conversions
  - **Code Quality**:
    - Fixed misleading indentation issues in manager.cc
    - Fixed shadow variable warnings by renaming conflicting variables
    - Removed dead store warnings by eliminating unused assignments
    - Fixed nodiscard warnings by properly handling return values
    - Fixed format string issues (int64_t vs long long)
  - **Files Fixed**:
    - `zone/dialog_zone.cc`: 138 → 102 warnings (36 fixed)
    - `zone/settings_zone.cc`: 102 → 95 warnings (7 fixed)
    - `zone/form_zone.cc`: 80 → 57 warnings (23 fixed)
    - `main/ui/report.cc`: 69 → 59 warnings (10 fixed)
    - `zone/payment_zone.cc`: 63 → 54 warnings (9 fixed)
    - `main/hardware/printer.cc`: 61 → 48 warnings (13 fixed)
    - `term/term_dialog.cc`: 62 → 32 warnings (30 fixed)
    - `main/data/credit.cc`: 49 → 25 warnings (24 fixed)
    - `zone/table_zone.cc`: 45 → 32 warnings (13 fixed)
    - `main/data/manager.cc`: 42 → 23 warnings (19 fixed)
  - **Impact**: All 10 files are now error-free with significantly reduced warnings. Code is safer, more maintainable, and follows modern C++ best practices. Critical security vulnerabilities from buffer overflows have been eliminated.
  - **Total Progress**: 710 → 529 warnings (181 warnings fixed), 0 errors across all files

- **Button Text Position Setting for Image Buttons (11-29-2025)**
  - **Feature**: Fixed "Button Text Position" setting to properly affect image buttons (ItemZone)
  - **Root Cause**: `ItemZone::Render()` was not checking or applying the `button_text_position` setting, only `ButtonZone` had this functionality
  - **Implementation**:
    - Added `button_text_position` support to `ItemZone::Render()` method with all three modes:
      - Mode 0: Text over image (default) - text renders on top of the image
      - Mode 1: Text above image - text in top 30%, image in bottom 70%
      - Mode 2: Text below image - image in top 70%, text in bottom 30%
    - Reads setting from `Settings->button_text_position` 
    - Applies proper text and image positioning based on selected mode
    - Maintains all existing functionality for non-image buttons
  - **Impact**: "Button Text Position" setting in General Settings now properly controls how text and images are positioned on menu item buttons with custom images
  - **Files modified**:
    - `zone/order_zone.cc` - Added button_text_position support to ItemZone::Render() with 3 positioning modes

### Added
- **Transparent PNG Support with Checkered Background Removal (11-29-2025)**
  - **Feature**: Automatic detection and removal of checkered backgrounds from transparent PNG images
  - **Implementation**:
    - Added `RemoveCheckeredBackground()` function in `term/term_view.cc` that detects and removes common checkered patterns (light gray/white alternating squares)
    - Algorithm samples multiple points in the image to detect checkered patterns
    - Automatically converts images to RGBA format if needed to support transparency
    - Makes detected checkered pixels fully transparent by setting their alpha channel to 0
    - Integrated into `LoadPNGFile()` to process images automatically during loading
  - **Impact**: Vastly expands access to transparent PNG images from the internet by automatically cleaning checkered backgrounds that are commonly added by image editors and websites
  - **Files modified**:
    - `term/term_view.cc` - Added checkered background detection and removal algorithm
    - `term/term_view.hh` - Updated Xpm constructor to support transparency masks

- **Button Image Persistence Fix (11-29-2025)**
  - **Feature**: Fixed critical bug where images added to buttons were not saving and persisting across program restarts, plus fixed black overlay when tapping buttons
  - **Root Cause**: `ItemZone::Copy()` method was not copying the `ImagePath()` field when zones were copied from terminal zone_db to parent zone_db during editing
  - **Implementation**:
    - Added `ImagePath()` copying to `ItemZone::Copy()` in `zone/order_zone.cc`
    - Added page redraw (`t->Draw(RENDER_NEW)`) after tapping buttons with images to immediately restore image display
    - Added extensive debug logging throughout the zone read/write/copy pipeline
    - Modified `Terminal::ReadZone()` to always read image paths for PosZone types
    - Added automatic save calls to `SaveMenuPages()` and `SaveTablePages()` after zone edits
  - **Impact**: Button images now correctly save to disk, persist across program restarts, and remain visible when tapped
  - **Files modified**:
    - `zone/order_zone.cc` - Added ImagePath copying in ItemZone::Copy() and page redraw in Touch()
    - `main/hardware/terminal.cc` - Fixed ReadZone() to always read image paths and trigger saves
    - `zone/pos_zone.cc` - Added debug logging to Read/Write methods
    - `zone/button_zone.cc` - Added debug logging to Copy method
    - `zone/zone.cc` - Added explicit ImagePath copying in CopyZone()
    - `term/term_dialog.cc` - Added debug logging to Send method

- **New Page Types and Qualifiers (11-28-2025)**
  - **Feature**: Added two new page types to support advanced modifier pages and enhanced navigation
  - **New Page Types**:
    - **Modifier Page with Keyboard** (Type 17, Parent -96): A modifier page with pre-positioned empty buttons and keyboard support for creating complex modifier pages with qualifiers (e.g., breakfast egg preparations: Soft Poach, Hard Scramble, Over Easy)
    - **Index with Tabs** (Type 18, Parent -94): An index page with tab-based navigation that child menu item pages automatically inherit, enabling one-touch navigation between any pages in the system
  - **New Qualifiers**:
    - **Easy**: For items prepared with ease (e.g., "Over Easy" eggs)
    - **Add**: For adding items or ingredients
    - **Senior Share**: For senior portion sharing options
  - **Note**: Pages -94 & -96 are currently under development as parent templates for these new page types
  - **Impact**: Significantly reduces time for editors creating modifier pages with qualifiers and setting up navigation tabs that propagate to all child pages
  - **Files modified**:
    - `zone/zone.hh`, `term/term_view.hh` - Added PAGE_MODIFIER_KEYBOARD and PAGE_INDEX_WITH_TABS constants
    - `main/ui/labels.cc` - Added page type names and qualifier names/values
    - `zone/zone.cc` - Added parent page relationships for new page types
    - `main/business/sales.hh` - Added QUALIFIER_EASY, QUALIFIER_ADD, QUALIFIER_SENIORSHARE constants
    - `main/business/sales.cc` - Added MergeQualifier and PrintItem cases for new qualifiers

- **General Settings Section Navigation (11-24-2025)**
  - **Feature**: Added section-based navigation to General Settings with tab buttons
  - **Implementation**:
    - Reorganized General Settings into 8 distinct sections: Business, Logon, Ledger, Drawer, SMTP, Misc, Restart, and Kitchen
    - Added section buttons at the top of the settings page for easy navigation between sections
    - Each section displays only its relevant fields, making the settings interface more organized and easier to navigate
    - Section switching automatically saves the current section before loading the new one
    - Active section is highlighted in blue for visual feedback
  - **Usage**: Users can click section buttons at the top of the General Settings page to switch between different setting categories
  - **Impact**: Improves usability by organizing settings into logical sections and reducing visual clutter
  - **Files modified**: 
    - `zone/settings_zone.hh` - Added section tracking and navigation support
    - `zone/settings_zone.cc` - Implemented section-based field activation, section switching, and button rendering
- **Order Comment Feature (2025-01-xx)**
  - **Feature**: Added ability to add comments to orders as modifier items
  - **Implementation**:
    - Created new `OrderCommentZone` button that appears on order entry pages when there's an active open check
    - Created `OrderCommentDialog` with QWERTY keyboard for text input
    - Comments are added as modifier orders under the selected order item, displaying indented like other modifiers
    - Dialog includes Done and Cancel buttons, with proper button layout to prevent overlap
  - **Usage**: Users can click the "Add Comment" button, type a comment using the QWERTY keyboard, and click Done to add it as a modifier under the currently selected order
  - **Impact**: Allows staff to add special instructions or notes to individual order items, which appear in the order list and on kitchen tickets
  - **Files modified**: 
    - `zone/order_zone.hh`, `zone/order_zone.cc` - Added OrderCommentZone class
    - `zone/dialog_zone.hh`, `zone/dialog_zone.cc` - Added OrderCommentDialog class
    - `zone/pos_zone.hh`, `zone/pos_zone.cc` - Added ZONE_ORDER_COMMENT type and wiring
    - `main/ui/labels.cc` - Added "Order Comment" to zone type list
    - `term/term_dialog.cc` - Updated zone editor to handle new zone type

### Improved
- **Settings Page UI Enhancements (11-27-2025)**
  - **Feature**: Enhanced General Settings page layout and usability
  - **Changes**:
    - Section buttons now extend to the horizontal line for better visual hierarchy and easier touch targeting
    - Business section is now properly selected and displayed when first visiting the Settings page
    - Button text now follows the Dialog font size setting instead of using a hardcoded font
    - Removed extraneous section label lines that were incorrectly appearing at the end of each section
  - **Impact**: Improved ergonomics, better visual consistency with other pages, and cleaner section boundaries
  - **Files modified**: 
    - `zone/settings_zone.cc` - Updated button positioning, sizing, font handling, and field activation logic

### Fixed
- **CI Build Failure: Systemd Service Installation Permission Denied (2025-01-XX)**
  - **Issue**: CI builds were failing due to permission errors when attempting to install systemd service files to `/etc/systemd/system/` and configuration files to `/etc/viewtouch/`. GitHub Actions runners don't have root permissions to write to system directories.
  - **Fix**: Updated `CMakeLists.txt` to conditionally skip systemd service and configuration file installations when running in CI environments. The build now detects the `CI` environment variable (automatically set by GitHub Actions) and skips these installations during CI builds.
  - **Impact**: CI builds now complete successfully. Systemd service files will still be installed during local builds with `sudo make install`, but are skipped during CI builds to avoid permission errors.
  - **Files modified**: `CMakeLists.txt`
- **Critical Crash Fixes: Memory Corruption and Infinite Recursion (2025-12-XX)**
  - **Issues**: Multiple critical crashes identified through GDB debugging:
    - `Terminal::Signal()` crashing with invalid `this` pointer (use-after-free)
    - Infinite recursion in `Terminal::Signal()` causing stack overflow (5000+ frames)
    - Memory corruption in atomic variables (`BT_Track`, `BT_Depth`) causing crashes
    - NULL pointer dereferences in `RInt8()`, `ReadZone()`, and signal processing
    - Array bounds violations when accessing `message[index]` without length checks
  - **Fixes**:
    - **Terminal::Signal()**:
      - Removed `FnTrace()` call that was crashing with invalid `this` pointer
      - Added NULL checks for `system_data` before accessing members (`eod_term`, `ArchiveListEnd()`, `user_db`)
      - Added NULL check for `message` parameter before processing
      - Added array bounds checks for `message[index]` accesses (CC_ADDBATCH, CLOSETAB2, CONTINUETAB2, FORCERETURN, etc.)
      - Added try-catch wrapper to handle memory corruption gracefully
      - Added recursion guard using `thread_local` to prevent infinite signal loops (max depth 100)
      - Added NULL checks at call sites before calling `Signal()`
    - **Terminal::RInt8()**: Added NULL check for `buffer_in` before accessing
    - **Terminal::ReadZone()**: Added NULL checks for `buffer_in` and `newZone` after creation
    - **BackTraceFunction** (fntrace.hh): Added try-catch blocks in constructor and destructor to handle corrupted atomic variables (`BT_Track`, `BT_Depth`)
    - **Message processing loop**: Added NULL check for `buffer_in` before accessing `size`
  - **Impact**: System is now resilient to memory corruption, use-after-free bugs, and infinite recursion. Prevents crashes from corrupted data structures, invalid pointers, and signal loops. The recursion guard prevents stack overflow from infinite signal recursion
  - **Files modified**: `main/hardware/terminal.cc`, `src/utils/fntrace.hh`

- **Additional Crash Prevention and Safety Improvements (2025-12-XX)**
  - **Issues**: Multiple potential crash points identified and fixed:
    - `GetSettings()` calls without NULL checks could cause crashes if settings were unavailable
    - Loops iterating through linked lists without iteration limits could cause infinite loops from corrupted data
    - Switch case variable scope issues causing compilation errors
  - **Fixes**:
    - Added NULL checks for `GetSettings()` in `Terminal::Init()` before accessing settings members
    - Added NULL check for `GetSettings()` in credit card settlement error handling
    - Added NULL check for `GetSettings()` in screen blanking timeout handling
    - Added iteration limits (10,000) to `LaborPeriod::Write()` and `WorkDB::Write()` loops to prevent infinite loops from corrupted WorkEntry lists
    - Added iteration limit (100,000) to `SaveAllChecks()` loop in DataPersistenceManager to prevent infinite loops from corrupted Check lists
    - Fixed switch case variable scope issue by wrapping case block in braces
    - Replaced duplicate drawer availability code with call to `GetDrawerUnavailableReason()` helper function
  - **Impact**: System is now more resilient to corrupted data and NULL pointer issues. Prevents crashes from infinite loops in corrupted linked lists and NULL pointer dereferences when settings are unavailable
  - **Files modified**: `main/hardware/terminal.cc`, `main/business/labor.cc`, `src/core/data_persistence_manager.cc`

- **System Crash During EndDay (2025-12-XX)**
  - **Issue**: System crashed when ending the day
  - **Root Causes**:
    - `ExtractOpenCheck()` could return NULL when there were no open subchecks, but the code was adding it to a list without checking, causing a NULL pointer crash
    - Empty Customer user checks (from self-order functionality) weren't being cleaned up before EndDay, potentially causing issues during archiving
  - **Fix**:
    - Added NULL check before adding checks to temporary list in `EndDay()` - only adds valid checks returned from `ExtractOpenCheck()`
    - Added cleanup logic to delete empty Customer user checks before EndDay, similar to how training checks are deleted
    - Empty Customer checks are now properly destroyed before archiving process begins
  - **Impact**: EndDay now completes successfully without crashing. Empty self-order checks are properly cleaned up, and NULL pointer crashes are prevented
  - **Files modified**: `main/data/system.cc`

- **System Crash When Clocked-In Users Log In After System Crash (2025-12-XX)**
  - **Issue**: When the system crashed and a user who was already clocked in tried to log in, start a check, or login again, the system would crash
  - **Root Causes**:
    - `GetSettings()` could return NULL, and accessing `settings->delay_time1` would crash
    - Corrupted labor database entries after a crash could return invalid job values that caused crashes when used
    - Corrupted WorkEntry linked lists could cause infinite loops or crashes when iterating through work entries
  - **Fix**:
    - Added NULL check for `GetSettings()` in `LoginUser()` before accessing settings members
    - Added validation for job values (0-999 range) in `LoginUser()` - invalid job values are reset to 0 to prevent crashes
    - Added iteration limit (10,000) in `CurrentWorkEntry()` to prevent infinite loops from corrupted linked lists
    - Added validation in `CurrentJob()` to ensure job values are reasonable before returning them
  - **Impact**: System now handles corrupted labor data gracefully after crashes. Users can log in safely even if labor database is corrupted. Prevents infinite loops and NULL pointer crashes
  - **Files modified**: `main/hardware/terminal.cc`, `main/business/labor.cc`

- **Unintended Self-Order Check Creation (2025-12-XX)**
  - **Issue**: Self-order checks were being created automatically even when not using self-order functionality:
    - Checks were created on terminal startup for SelfOrder terminals
    - Checks were created when non-customer users logged out from SelfOrder terminals
    - Checks were created when tapping buttons with "quickdinein" or "quicktogo" messages on regular terminals or non-self-order pages
  - **Root Causes**:
    - `QuickMode(CHECK_SELFORDER)` was called automatically on terminal startup
    - `QuickMode(CHECK_SELFORDER)` was called automatically on logout for SelfOrder terminals
    - `QuickMode()` had no validation to prevent self-order check creation outside of self-order mode
  - **Fix**:
    - Removed automatic `QuickMode()` call from terminal startup - checks are now only created when customers tap ordering buttons
    - Removed automatic `QuickMode()` call from `LogoutUser()` - terminal re-logs in as Customer but doesn't create a check
    - Added validation in `QuickMode()` to only allow self-order checks (`CHECK_SELFORDER`, `CHECK_SELFDINEIN`, `CHECK_SELFTAKEOUT`) when:
      - Terminal type is `TERMINAL_SELFORDER`, OR
      - Current page is page -2 (`PAGEID_LOGIN2`, the self-order page)
    - Modified `QuickMode()` to reuse existing open checks instead of always creating new ones
  - **Impact**: Self-order checks are now only created when customers actually start ordering via button presses, preventing accumulation of empty checks. Buttons like "quickdinein" and "quicktogo" no longer create checks on regular terminals or non-self-order pages
  - **Files modified**: `main/hardware/terminal.cc`

- **New Items Not Appearing on Video Targets After Check Served (2025-12-XX)**
  - **Issue**: When a check was sent to a video target, tapped twice (marked as served), and then new items were added to the same check, the new items did not appear on the video target
  - **Root Cause**: When a check was marked as served (`CF_KITCHEN_SERVED` or `CF_BAR_SERVED`), `IsKitchenCheck()` would return 0, hiding the check entirely. Even though new items were added, the check remained hidden because the served flag was still set
  - **Fix**:
    - Modified `IsKitchenCheck()` in `ReportZone` to detect new items (orders without `ORDER_SHOWN` and without `ORDER_MADE` that match the video target)
    - When new items are detected, automatically clear the served flag (`CF_KITCHEN_SERVED` or `CF_BAR_SERVED`) and `CF_SHOWN` so the check appears again
    - Modified `PrintWorkOrder()` and `MakeReport()` to only clear `ORDER_SHOWN` from new items (not already-made items), ensuring already-made items remain hidden
    - Logic ensures that only new items are displayed, while items that were already made and served remain hidden
  - **Impact**: New items added to a served check now correctly appear on their respective video targets, while already-made items remain hidden. This allows kitchen/bar staff to see only the new work that needs to be done
  - **Files modified**: `zone/report_zone.cc`, `main/business/check.cc`

- **Kitchen Video Alert System (2025-12-XX)**
  - **Issue**: Alerts (warn/alert/flash color changes) were not working on kitchen video displays
  - **Root Causes**:
    - Alert logic was only implemented in `MakeReport()` but not in `PrintWorkOrder()`, which is used when `kv_print_method != KV_PRINT_UNMATCHED`
    - `chef_time` was not being set when checks were displayed on kitchen video via `PrintWorkOrder()`, preventing elapsed time calculation
  - **Fix**:
    - Added alert logic to `PrintWorkOrder()` to match the implementation in `MakeReport()`
    - Added `chef_time` initialization in `PrintWorkOrder()` when displaying kitchen video (similar to `MakeReport()`)
    - Alert condition ensures alerts only work for:
      - Report buttons with Button Type "Report" and Report Type "Check"
      - Report zones with a specific Video Target (not PRINTER_DEFAULT)
      - Orders that have a matching video target (not PRINTER_DEFAULT or PRINTER_NONE)
      - Checks with `chef_time` set (for elapsed time calculation)
  - **Impact**: Kitchen video alerts now work correctly for both `MakeReport()` and `PrintWorkOrder()` code paths, providing visual feedback (warn → alert → flash) based on order age
  - **Files modified**: `main/business/check.cc`

- **Video Target Timer and Display Issues (2025-11-26)**
  - **Issue 1 - Timer Starting Incorrectly**: When users added items that don't go to video targets (kitchens/bars), the timer would start. Then when items going to video targets were added later, those displays would see incorrect elapsed time
  - **Root Cause 1**: `chef_time` (the timer start time) was set whenever orders were finalized or the check was closed, regardless of whether any orders were actually destined for video targets
  - **Fix 1**:
    - Added `HasVideoTargetOrders()` method to check if a check has any orders going to video targets (not PRINTER_DEFAULT or PRINTER_NONE)
    - Modified `FinalizeOrders()` and `Close()` to only set `chef_time` when there are orders that actually go to video targets
    - This ensures the timer only starts when items destined for kitchens/bars are sent, not when non-video items (like retail) are sent
  - **Issue 2 - Already-Made Items Reappearing**: When a check was tapped twice (marked as served) and then new items were added, ALL items (including already-made ones) would reappear
  - **Root Cause 2**: In `MakeReport()`, the display logic didn't check the `ORDER_SHOWN` flag before displaying orders on video targets. The system uses `ORDER_SHOWN` to track which orders have been displayed and should not be shown again (unless they're new orders)
  - **Fix 2**:
    - Added `ORDER_SHOWN` flag checks in `MakeReport()` for both orders and modifiers
    - When displaying on video targets, now skips orders/modifiers that have `ORDER_SHOWN` flag set
    - This ensures only new items (without `ORDER_SHOWN`) are displayed when a check reappears
    - Note: `PrintWorkOrder()` already had this logic via `PrintStatus()`, but `MakeReport()` was missing it
  - **Impact**: Kitchen and bar displays now show accurate elapsed time for orders AND only display new items when checks reappear after being marked as served
  - **Files modified**: `main/business/check.hh`, `main/business/check.cc`


### Added
- **Default Configuration Improvements (2025-12-XX)**
  - **Default Revenue Groups**: Set intelligent defaults for family-to-revenue-group mappings
    - Beverage → Beverage
    - Beer and Bottled Beer → Beer
    - Wine and Bottled Wine → Wine
    - Alcohol and Cocktail → Alcohol
    - Malt Beverage (Bottled Cocktail) → Alcohol
    - All other families default to Food
  - **Default Users**: Automatically create three default users when settings file is first created
    - Manager (ID 5) with all authorizations
    - Server/Cashier with all authorizations except Supervisor, Manager, and Employee records
    - Server without Settlement authority
  - **Server Display Defaults**: New Server Display terminals automatically configured with Fast Food type and One Cash Drawer
  - **Self Order Mode Auto-Configuration**: Page variant automatically set to -2 (Page -2) when Self Order Mode is selected

### Fixed
- **Printer activation dialog crash**: Prevented heap-buffer-overflow in `Terminal::KillDialog()` when closing non-DialogZone dialogs (e.g., MessageDialog used during printer activation). The dialog cleanup now checks the concrete type before reading jump/signal metadata, eliminating crashes when toggling printers. (Files: `main/hardware/terminal.cc`)
- **Crash reporting robustness**: Added SIGABRT handling so ASan-triggered aborts also generate reports, and tightened crash-report directory creation (keeps primary path `/usr/viewtouch/dat/crashreports`). (Files: `main/data/manager.cc`, `src/core/crash_report.cc`)
  - **Enhanced Drawer Availability Messages**: Improved error messages that specify the exact reason why a drawer is unavailable
    - Trusted mode: "No drawer is attached to this terminal"
    - Server Bank mode: "No drawers are configured" or "Unable to create Server Bank drawer"
    - Assigned mode: "No drawers are assigned to this user or available for assignment"
  - **Impact**: Faster system setup with sensible defaults, better user experience with clear error messages
  - **Files modified**: `main/data/settings.cc`, `main/data/manager.cc`, `zone/hardware_zone.cc`, `zone/payment_zone.cc`, `main/hardware/terminal.cc`

- **Enterprise-Grade Connection Reliability System (2025-11-19)**
  - **Feature**: Complete overhaul of ViewTouch's connection handling to prevent system freezing during network interruptions
  - **Components**:
    - **Non-Blocking I/O**: All network operations now use timeouts and non-blocking sockets to prevent indefinite hangs
    - **Connection State Management**: New `ConnectionMonitor` class tracks connection health with heartbeat monitoring
    - **Robust Reconnection**: Exponential backoff reconnection logic (2s→4s→8s→16s→60s max) with automatic retry limits
    - **Graceful Degradation UI**: "RECONNECTING TO SERVER..." overlay displays during connection loss with automatic dismissal on recovery
    - **UI State Preservation**: Saves and restores screen state, cursor position, and user context across disconnections
  - **Reliability Improvements**:
    - Zero-downtime operation - system continues running when connections fail
    - Automatic recovery - no manual intervention required for network issues
    - Network resilience - handles unstable connections, ISP outages, and remote display disconnections
    - User-friendly feedback - clear visual indicators of connection status
  - **Impact**: Eliminates ViewTouch freezing when remote displays disconnect, enabling reliable remote access without port forwarding
  - **Files modified**: `src/network/remote_link.cc`, `term/term_view.cc`

- **Reverse SSH Tunnel System (2025-11-21)**
  - **🚨 DEVELOPMENT STATUS**: This feature is currently under development and requires further testing before production use
  - **Feature**: Complete reverse SSH tunneling system for secure remote access to ViewTouch POS systems
  - **Components**:
    - **Integrated Service**: Built into ViewTouch main application, always enabled when ViewTouch runs
    - **Standalone Daemon**: Independent reverse SSH daemon for advanced deployments
    - **Multi-Location Support**: Separate tunnels and configurations for multiple restaurant/store locations
    - **Automated Setup**: `vt_reverse_ssh_setup` script for easy tunnel configuration without dedicated servers
    - **Management Tools**: `vt_reverse_ssh` and `vt_ssh_security` scripts for tunnel management and security
  - **Functionality**:
    - **Reverse Tunnels**: ViewTouch systems initiate outbound SSH connections to management servers
    - **Always-On**: Service automatically starts with ViewTouch and maintains persistent tunnels
    - **Location Identification**: Each location gets unique ports and configuration files for easy identification
    - **No Public IPs Required**: Works through NAT/firewalls without port forwarding
    - **Multiple Methods**: Support for dedicated servers, personal computers, ngrok, and serveo
  - **Security Features**:
    - SSH key-based authentication (password authentication disabled)
    - Encrypted tunnels using standard SSH protocols
    - Configurable reconnect intervals and health checks
    - Automated key management and rotation tools
  - **Management Interface**:
    - `vt_reverse_ssh_setup ngrok [location]` - Automated ngrok tunnel setup
    - `vt_reverse_ssh_setup personal [location]` - Use personal computer as server
    - `vt_reverse_ssh_setup status` - Monitor all location tunnels
    - `vt_reverse_ssh stop [location]` - Stop specific or all tunnels
  - **Configuration Files**:
    - `/etc/viewtouch/reverse_ssh.conf` - Main configuration
    - `/etc/viewtouch/reverse_ssh_[location].conf` - Location-specific configs
    - Systemd service integration for daemon management
  - **Files Added**: `src/network/reverse_ssh_service.*`, `src/network/reverse_ssh_daemon.cc`, `scripts/tools/vt_reverse_ssh*`, `config/reverse_ssh_daemon.conf`, `scripts/system/reverse-ssh-daemon.service`, `docs/REVERSE_SSH.md`
  - **Impact**: Enables secure remote access and support for ViewTouch systems without requiring public IP addresses or complex firewall configurations
  - **⚠️ Testing Required**: Feature needs extensive real-world testing across different network environments before production deployment

- **New Clear System Button Zone Type (2025-11-14)**
  - **Feature**: Added dedicated `ClearSystemZone` button type with countdown safety mechanism
  - **Functionality**:
    - Button displays "Clear System (10)" and counts down with each tap
    - Visual countdown provides clear feedback: 10→9→8...→1→0
    - At countdown 0, presents dialog with options:
      - "Yes" - Clear all system data including labor records
      - "No" - Clear system data but preserve labor records
      - "Cancel" - Reset countdown to 10 without clearing
    - Calls `System::ClearSystem(all)` to remove all archived data, current data, and stock data
  - **Safety**: Requires 10 intentional taps before activation, prevents accidental data loss
  - **Zone Type**: `ZONE_CLEAR_SYSTEM` (ID: 107)
  - **Usage**: Available in zone editor dropdown as "Clear System" - place on Developer Settings or admin pages
  - Files modified: `zone/button_zone.hh`, `zone/button_zone.cc`, `zone/pos_zone.hh`, `zone/pos_zone.cc`, `main/ui/labels.cc`

### Fixed
- **Fixed DPI for Consistent Font Rendering Across All Displays (2025-12-XX)**
  - **Issue**: With scalable fonts (Xft), each display device required different DPI settings, causing inconsistent font sizes across different displays
  - **Solution**: Implemented fixed DPI (96) for all font loading operations
    - All font specifications now automatically include `:dpi=96` parameter
    - Ensures fonts render at the same size regardless of display DPI
    - Works consistently across Raspberry Pi, desktop monitors, and other displays
  - **Impact**: Fonts now render consistently across all displays, similar to the old bitmap fonts behavior
  - **Files modified**: `term/term_view.cc`, `main/data/manager.cc`

- **Raspberry Pi Performance Optimizations (2025-12-XX)**
  - **Issue**: Significant UI delay on Raspberry Pi Compute Module 5
  - **Optimizations**:
    - **Color Caching**: Implemented `ColorCache` to cache `XRenderColor` values, eliminating expensive `XQueryColor()` calls
    - **Drop Shadow Optimization**: Reduced drop shadow rendering from multiple draw calls to optimized single-pass rendering
    - **Raspberry Pi Auto-Detection**: Automatically detects Raspberry Pi/ARM hardware and disables expensive rendering effects (drop shadows, embossed text, blur)
    - **Reduced XFlush Calls**: Removed unnecessary `XFlush()` calls in layer operations to reduce blocking operations
  - **Impact**: Significantly improved UI responsiveness on Raspberry Pi hardware
  - **Files modified**: `term/term_view.hh`, `term/term_view.cc`, `term/layer.cc`, `src/core/generic_char.cc`

- **Printer Target Safety and Reliability Improvements (2025-11-21)**
  - **Issues**: Multiple safety and reliability issues in printer operations
    - String truncation warnings in `MakeFileName()` and PostScript output functions
    - Missing error checking for `write()` system calls
    - Type conversion warnings (ssize_t to int, int to genericChar)
    - Unsafe string operations throughout printer and hardware modules
  - **Fixes**:
    - Replaced unsafe `strncpy()` and `sprintf()` calls with `vt_safe_string::safe_copy()` and `vt_safe_string::safe_format()`
    - Added comprehensive error checking for all write operations with proper error logging
    - Fixed type conversions using `static_cast<>()` and proper ssize_t handling
    - Eliminated 90+ compiler warnings in printer.cc
  - **Impact**: Significantly improved printer reliability, eliminated buffer overflows, and enhanced error reporting
  - **Files modified**: `main/hardware/printer.cc`, `main/hardware/cdu.cc`, `main/business/customer.cc`, `main/business/employee.cc`, `main/data/credit.cc`

- **Build Failure - Buffer Size Mismatch and Const-Correctness Issues (2025-11-21)**
  - **Issues**: Build failed with array bounds errors and const-correctness compilation errors
    - Buffer size mismatch in `safe_format` calls - using `STRLONG` (2048 bytes) for `STRLENGTH` (512 byte) buffers
    - Const-correctness issue with Motif `XmTextSetString` function expecting `char*` but receiving `const char*`
  - **Fixes**:
    - Fixed buffer size parameters in `safe_format` and `safe_concat` calls in `PrintWorkOrder()` method
    - Changed all `STRLONG` parameters to `STRLENGTH` to match actual buffer sizes (512 bytes)
    - Added `const_cast<char*>()` to resolve Motif API const-correctness requirements
  - **Impact**: Build now completes successfully, eliminating array bounds warnings and compilation errors
  - Files modified: `main/business/check.cc`, `term/term_dialog.cc`

- **CMake Deprecation Warnings (2025-11-17)**
  - **Issue**: CMake deprecation warnings when building the project
    - CMake minimum_required version 3.5.1 compatibility warning with CMake 3.31.6
    - Policy CMP0153 warning about deprecated `exec_program` command
  - **Fix**:
    - Updated `cmake_minimum_required` from `VERSION 3.5.1` to `VERSION 3.10` in `CMakeLists.txt`
    - Replaced deprecated `exec_program()` with modern `execute_process()` in `cmake/gen_compiler_tag.cmake`
    - Added `OUTPUT_STRIP_TRAILING_WHITESPACE` and `ERROR_QUIET` options to `execute_process()` for better output handling
  - **Impact**: Eliminates CMake deprecation warnings during build configuration
  - Files modified: `CMakeLists.txt`, `cmake/gen_compiler_tag.cmake`

- **Self Order Drawer Access Issue (2025-11-20)**
  - **Issue**: "No Drawer is Available for Payment" error inappropriately appeared in Self Order mode during payment settlement
  - **Root Cause**: Customer user (ID 999) on Self Order terminals did not have guaranteed drawer access, causing payment processing to fail even when payment was supposedly "immediate"
  - **Fix**: Modified `FindDrawer()` method to ensure Customer user on Self Order terminals always gets their own dedicated drawer using server bank logic, bypassing normal drawer mode restrictions
  - **Impact**: Self Order terminals can now properly process payments without drawer availability errors, maintaining the "immediate payment" functionality
  - Files modified: `main/hardware/terminal.cc`

- **Credit Card Fee Tax Calculation (2025-11-17)**
  - **Issue**: Credit card fees (both dollar and percentage amounts) were not being included in tax calculations
  - **Root Cause**: Credit card fees were added to the transaction balance but not included in the taxable revenue bases used for tax calculations
  - **Fix**: 
    - Credit card fees are now collected and added to taxable revenue after orders are processed
    - Percentage-based fees are recalculated after `raw_sales` is known to ensure accurate amounts
    - Fees are distributed proportionally across all tax revenue bases (food, alcohol, room, merchandise) to ensure they're included in all applicable tax calculations
    - Fees are added after the takeout check to prevent them from being zeroed out when takeout food isn't taxed
    - Food tax is recalculated after fees are added to include tax on the fees
  - **Impact**: Credit card fees are now properly taxed according to the applicable tax rates (food tax, alcohol tax, GST, PST, HST, QST, room tax, merchandise tax, VAT)
  - Files modified: `main/business/check.cc`

- **Critical Bug Fixes - Memory Leaks and Security Issues (2025-11-13)**
  - **Issues**: Multiple critical bugs causing file descriptor leaks, memory leaks, and buffer overflow vulnerabilities
  - **Fixes**:
    1. **File Descriptor Leaks**:
       - Fixed `temp_fd` leak in `Printer::SocketPrint()` - file descriptor now properly closed on all return paths
       - Fixed socket leak in `CustDispUnit::SocketOpen()` - socket now closed on connect failure
       - Fixed socket leak in `ListAddresses()` - socket properly closed before function return
    2. **Memory Leaks**:
       - Fixed JobInfo allocation failure handling in 3 locations (NewSelfOrder, QuickMode, Terminal setup)
       - Added proper cleanup: delete Employee object if JobInfo allocation fails
       - Prevents memory leak when allocation fails during Customer user creation
    3. **Buffer Overflow Vulnerabilities**:
       - Replaced unsafe `strcpy()` with `strncpy()` with proper null termination in `OpenTerminalSocket()`
       - Replaced all `sprintf()` calls with `snprintf()` with buffer size checks (4 locations)
       - Eliminates potential buffer overflow attack vectors
    4. **Code Quality Improvements**:
       - Extracted duplicated Customer Employee creation logic into centralized helper function `GetOrCreateCustomerUser()`
       - Eliminated ~100 lines of code duplication across 4 locations
       - Improved maintainability and consistency
    5. **Build Fix**:
       - Added missing `#include <unistd.h>` for `close()` function in license_hash.cc
  - **Impact**: 
    - Prevents file descriptor exhaustion and system instability
    - Eliminates memory leaks in error paths
    - Closes security vulnerabilities from buffer overflows
    - Improves code maintainability and reduces bug introduction risk
  - Files modified: `main/hardware/printer.cc`, `main/hardware/cdu.cc`, `main/data/license_hash.cc`, `main/hardware/terminal.cc`, `docs/BUG_ANALYSIS.md`

- **Medium Priority Bug Fixes - Memory Safety Improvements (2025-11-13)**
  - **Issues**: Potential infinite loop in order deletion and unclear ownership semantics in Copy methods
  - **Fixes**:
    1. **Order Deletion Safety** (`zone/order_zone.cc`):
       - Added safety counter (max 1000 modifiers) to prevent infinite loops if list corruption occurs
       - Added corruption detection to verify `Remove()` properly unlinked items
       - Added error logging to help debug any list corruption issues
       - Protects against crashes from use-after-free or double-free scenarios
    2. **Smart Pointer Copy Methods**:
       - Added `SubCheck::CopyUnique()` returning `std::unique_ptr<SubCheck>` for safe memory management
       - Complements existing `Order::CopyUnique()` for consistent modern C++ patterns
       - Eliminates ambiguity about ownership of copied objects
       - Prevents memory leaks when callers forget to delete copied objects
  - **Impact**:
    - Prevents potential infinite loops and crashes from list corruption
    - Improves code safety with clear ownership semantics
    - Modernizes codebase with C++11/14/17 best practices
  - Files modified: `zone/order_zone.cc`, `main/business/check.hh`, `main/business/check.cc`

- **Double Modifier Decimal Multiplier (2025-11-11)**
  - **Issue**: Developer settings rejected fractional double multipliers, causing charges to ignore decimal values when combining multiply and add/subtract adjustments
  - **Fix**: `double_mult` now stores a floating-point multiplier with proper rounding, allowing values like 1.5 or 0.75 to work alongside `double_add`
    - Updated `Settings` serialization to version 104 with backward compatibility for legacy integer values
    - Adjusted `SalesItem::Price()` to compute the final price using floating-point math with cent rounding
    - Developer settings UI accepts and displays decimal multipliers without truncation
  - **Impact**: Fractional double pricing now calculates correctly for decimal multipliers and additive/subtractive adjustments
  - Files modified: `main/business/sales.cc`, `main/data/settings.{hh,cc}`, `zone/settings_zone.cc`, `docs/changelog.md`
- **Tax Calculation Including Modifiers (2025-11-05)**
  - **Issue**: Tax calculation was inconsistent between main checkout system and per-order display
  - **Root Cause**: `Order::CalculateTax()` used `cost` (excluding modifiers) while main system used `total_cost` (including modifiers)
  - **Fix**: Updated `Order::CalculateTax()` to use `total_cost` instead of `cost` for consistent tax calculation
    - Changed taxable amount calculation on line 5855 of `main/business/check.cc`
    - Tax now properly includes modifier costs across all calculation methods
  - **Impact**: Tax is now consistently calculated on order total including modifiers throughout the system
  - Files modified: `main/business/check.cc`

- **Image Selection "None" Not Persisting (2025-11-05)**
  - **Issue**: Setting an image to "None" in button properties would not save - previous image would reappear after save
  - **Root Cause**: Auto-restoration logic in `order_zone.cc` was restoring images from item data whenever zone's ImagePath was empty
  - **Fix**: Changed image sync logic to be one-way (zone → item) instead of bi-directional
    - Removed auto-restore from item to zone (lines 1555-1558)
    - Added explicit clearing of item's image when zone is set to "None"
    - Zone's image selection (including "None") now properly persists
  - **Impact**: Users can now set images to "None" and the selection properly saves and persists
  - Files modified: `zone/order_zone.cc`

- **Self-Order Check Accumulation (2025-11-04)**
  - **Issue**: Multiple open checks were being created when customers made orders or left without placing orders on self-order terminals
  - **Root Cause**: `QuickMode()` was creating a new check every time without cleaning up previous empty checks for the Customer user
  - **Fix**: Added cleanup logic to destroy any existing empty checks for Customer user before creating a new one
    - Checks for empty checks owned by Customer user (ID 999) before creating new check
    - Only destroys checks with `serial_number > 0` to avoid issues with newly created checks
    - Prevents accumulation of abandoned checks when customers browse menu without ordering
  - **Impact**: Self-order terminals now maintain only one check per customer session instead of accumulating multiple open checks
  - Files modified: `main/hardware/terminal.cc`

### Added
- **📝 48-Point Font Support (2025-11-13)**
  - **New Fonts**: Added 48-point font size (larger than existing 34-point maximum)
    - `FONT_TIMES_48` (ID 1) - DejaVu Serif 48pt regular
    - `FONT_TIMES_48B` (ID 2) - DejaVu Serif 48pt bold
    - Xft specification: `size=28` renders at 51 pixels height (vs 33 pixels for 34pt)
  - **Font ID Management**: Fixed enum conflicts by using explicit font ID values
    - Removed auto-assignment from `font_info` enum to prevent ID conflicts
    - Font IDs 1 and 2 assigned to new 48pt fonts
    - Added legacy `FONT_FIXED_*` mappings for backward compatibility
  - **UI Integration**: Added font options to UI selection menus
    - "DejaVu Serif 48pt" and "DejaVu Serif 48pt Bold" now available in font dropdowns
    - Bold/regular toggle works correctly with 48pt fonts
  - **Impact**: Users can now use much larger fonts for better visibility on high-resolution displays or accessibility needs
  - Files modified: `config/font_ids.hh`, `main/data/manager.cc`, `term/term_view.cc`, `term/term_view.hh`, `main/ui/labels.cc`, `main/hardware/terminal.hh`, `main/hardware/terminal.cc`, `src/utils/font_check.cc`

- **🖼️ Global Button Image Toggle (2025-11-08)**
  - **Settings Switch**: Added "Show Button Images" toggle to Settings switches so users can enable/disable images globally
    - New switch constant `SWITCH_BUTTON_IMAGES` toggles the global default
    - Updated `SwitchZone` to render and handle the new toggle
  - **Terminal Sync**: Terminals now adopt the global default on setting changes while still allowing per-terminal overrides via the existing `toggleimages` signal
    - Terminals mark active pages dirty so UI refreshes immediately after toggles
  - **Persistence**: Stored global preference in settings data (`show_button_images_default`) with `SETTINGS_VERSION` bumped to 103
    - Load/Save logic reads and writes the persisted flag
  - Files modified: `main/data/settings.{hh,cc}`, `zone/settings_zone.cc`, `main/ui/labels.cc`, `main/hardware/terminal.cc`
- **🚀 Edit Mode Drag Performance (2025-11-08)**
  - **Deferred Rendering**: Suspending full page redraws while dragging zones now relies on a lightweight overlay preview for immediate feedback
  - **Preview Overlay**: The editor draws a dynamic drag rectangle so button moves stay responsive even while the cursor is in motion, even for multi-zone selections
  - **Minimal Repaint Path**: Continuous drag updates now mutate an off-screen region accumulator instead of forcing zone re-rendering and pixmap uploads each mouse move
  - **Final Commit**: Zone positions only redraw once at drop time, keeping X11 smooth and eliminating freeze-like behavior when moving image-heavy buttons
  - **Shadow Awareness**: Drag preview and final redraw take zone shadows into account so what you see during the move precisely matches the drop result
  - Files modified: `main/hardware/terminal.{hh,cc}`, `zone/zone.{hh,cc}`

- **📋 Dialog Menu Multi-Column Layout for Long Lists (2025-11-04)**
  - **Multi-Column Display**: Button properties dialogs with more than 8 options now automatically display in multiple columns instead of going off-screen
    - Modified `DialogMenu::Init()` in `term/term_dialog.cc` to detect long option lists
    - When > 8 items are present, menu uses `XmPACK_COLUMN` with automatic column calculation (8 rows per column)
    - Each additional 8 items creates a new column, keeping menus fully visible on screen
    - Applies to all dropdown fields in button/zone properties dialogs (type, behavior, colors, fonts, etc.)
  - Files modified: `term/term_dialog.cc`
  - Result: Long dropdown menus in properties dialogs now stay on screen with multi-column layout instead of requiring scrolling off-screen
- **🖼️ Image Button Transparency and Text Overlay Support (2025-11-04)**
  - **PNG Transparency**: Fixed PNG transparency to properly use alpha channel masking instead of filling transparent pixels with gray
    - Added mask pixmap support to `Xpm` class for proper transparency rendering
    - Updated `LoadPNGFile()` to create 1-bit mask pixmap for alpha channel
    - Modified `Layer::DrawPixmap()` to use `XSetClipMask` for proper transparency compositing
    - Transparent backgrounds now show the button texture underneath
  - **Text Overlay on Image Buttons**: Button text and prices now display with configurable positioning
    - Added `button_text_position` setting: 0=over image (default), 1=above image, 2=below image
    - Setting accessible in General Settings page under "Button Text Position" dropdown
    - Text is drawn with proper contrast and shadows for readability on images
    - Text automatically splits button into 70/30 ratio when positioned above/below
  - **Image Display Mode Toggle**: Added per-terminal control for showing/hiding button images
    - Added `show_button_images` flag to Terminal class for per-terminal image display control
    - Added `toggleimages` signal command for runtime toggling (affects only the terminal issuing command)
    - Create a message button with signal "toggleimages" to toggle between modes
    - Each terminal can independently show images or text-only mode without affecting other terminals
  - **Settings Version**: Incremented to version 102 for new display settings (deprecated show_button_images moved to per-terminal flag)
  - Files modified: `term/term_view.{hh,cc}`, `term/layer.cc`, `zone/button_zone.cc`, `main/hardware/terminal.{hh,cc}`, `main/data/settings.{hh,cc}`
  - Result: PNG images with transparency display correctly, text is readable on all image buttons with configurable position, and users can toggle image display mode
- **🖼️ Image Button Rendering Refresh (2025-11-02)**
  - Button zones now paint selected images behind the frame using the interior content area.
  - Image filenames persist via updated `PosZone` serialization (`ZONE_VERSION 29`) so saves and copies keep selections.
  - Copying any button-like zone (Message, Conditional, Image button, etc.) retains its associated image.
  - Files touched: `zone/button_zone.{hh,cc}`, `zone/pos_zone.{hh,cc}`.
  - Result: Selecting a PNG/JPG/GIF in Button Properties immediately shows on-screen and survives page reloads.
- **System Page Validation Function**: Added `ZoneDB::ValidateSystemPages()` to detect data integrity issues
  - **Purpose**: Checks for System Pages (PAGE_SYSTEM = 0) with invalid parent_id values (> 0)
  - **Detection**: Identifies corrupted data files where System Pages incorrectly have parent relationships
  - **Reporting**: Logs detailed error messages and returns count of invalid pages found
  - **Usage**: Can be called during startup or maintenance to verify data integrity
  - Files added: `zone/zone.{hh,cc}` function `ValidateSystemPages()`
- **🧪 Comprehensive Testing Infrastructure**: Complete unit testing framework with Catch2
  - Added 38 test cases covering core business logic, memory safety, string operations, input validation, and logging
  - Mock objects for Terminal, Settings, and other dependencies to enable isolated testing
  - Automated test execution with detailed reporting and CI/CD integration
  - Files added: `tests/unit/test_*.cc`, `tests/mocks/mock_*.{hh,cc}`, `tests/main_test.cc`, `tests/CMakeLists.txt`

- **🛡️ Memory Safety Modernization**: Replaced manual memory management with modern C++ smart pointers
  - **Smart Pointer Factory Functions**: `std::unique_ptr` and `std::shared_ptr` for automatic resource management
  - **RAII Ownership Transfer**: Safe ownership transfer utilities for C-style APIs
  - **Memory Leak Prevention**: Eliminated memory leaks in Check and Report management
  - **Exception Safety**: Automatic cleanup on exceptions and early returns
  - Files modified: `main/business/check.{hh,cc}`, `src/utils/memory_utils.{hh,cc}`

- **🔒 String Safety Overhaul**: Replaced unsafe C-style string functions with safe C++ alternatives
  - **Safe String Operations**: `safe_copy`, `safe_cat`, `safe_format`, `safe_format_string` functions
  - **Buffer Overflow Prevention**: All string operations now prevent buffer overflows and null pointer dereferences
  - **UTF-8 Validation**: Proper Unicode string handling and validation
  - **Legacy Code Migration**: Updated utility.cc, vt_ccq_pipe.cc, and socket.cc with safe operations
  - Files modified: `src/utils/safe_string_utils.{hh,cc}`, `src/utils/utility.cc`, `src/network/vt_ccq_pipe.cc`, `src/network/socket.cc`

- **✅ Comprehensive Input Validation**: Enterprise-grade input validation and sanitization system
  - **Network Data Validation**: Hostname, port, buffer size, and protocol message validation
  - **Business Logic Validation**: Price, quantity, tax rate, employee ID, and check total validation
  - **User Input Sanitization**: Name, email, phone, password, and username validation with XSS prevention
  - **Security Validation**: SQL injection, command injection, path traversal, and buffer overflow detection
  - **Configuration Validation**: File path, time/date format, and permissions checking
  - Files added: `src/utils/input_validation.{hh,cc}`, `tests/unit/test_input_validation.cc`

- **📊 Enhanced Structured Logging**: Modern logging system with business intelligence capabilities
  - **High-Performance Async Logging**: Multi-sink architecture with spdlog (file, console, syslog)
  - **Structured JSON Logging**: Machine-parseable logs for analysis and monitoring tools
  - **Business Context Tracking**: Thread-local session management with user, check, and table context
  - **Performance Monitoring**: Operation timing, metrics collection, and counter tracking
  - **Legacy Compatibility**: Bridge to existing syslog-based logging systems
  - Files modified: `src/utils/vt_logger.{hh,cc}`, `tests/unit/test_enhanced_logging.cc`

- **🚀 Modern C++17/20 Features**: Comprehensive adoption of modern C++ standards
  - **Smart Pointers**: `std::unique_ptr`, `std::shared_ptr` throughout codebase
  - **RAII Principles**: Resource acquisition is initialization for automatic cleanup
  - **Type Safety**: Strong typing with `std::variant`, `std::optional`, and custom enums
  - **Performance**: Async operations, thread-local storage, and optimized memory management
  - **Maintainability**: Clean interfaces, comprehensive documentation, and modular design

- **🛠️ Build System Enhancements**: Modern CMake configuration with external dependencies
  - **Dependency Management**: Automatic fetching and building of spdlog, nlohmann_json, Catch2
  - **Cross-Platform Support**: Improved toolchain definitions and compiler detection
  - **Test Integration**: Automated test discovery and execution in build process
  - **Code Quality**: Enhanced compiler warnings and static analysis integration

- **Advanced Button Shapes**: Expanded button shape options with three new geometric shapes
  - **Hexagon** (`SHAPE_HEXAGON = 4`) - 6-sided regular polygon rendering
  - **Octagon** (`SHAPE_OCTAGON = 5`) - 8-sided regular polygon with trigonometric vertex calculation
  - **Triangle** (`SHAPE_TRIANGLE = 6`) - 3-sided upward-pointing triangle
  - All shapes support textures, shadows, frame borders, and all existing button properties
  - Updated UI configuration dialogs to include new shape options
  - Files modified: `term/layer.{hh,cc}`, `term/term_view.hh`, `main/ui/labels.cc`

- **🖼️ Universal Image Support for All Button Types**: Extended image functionality to all button zone types (Simple, Item, Qualifier, Table buttons) with full multi-format graphical rendering and scaling
  - **PosZone Inheritance**: Any zone inheriting from PosZone can now optionally display background images
  - **Zone Types**: `ZONE_SIMPLE`, `ZONE_ITEM`, `ZONE_QUALIFIER`, `ZONE_TABLE`, and `ZONE_IMAGE_BUTTON` all support images
  - **Supported Formats**: XPM, PNG, JPEG, GIF with automatic format detection and loading
  - **Permission Control**: Restricted to Editor and Super User roles only
  - **Installation**: Auto-creates `/usr/viewtouch/imgs/` directory with default images and proper permissions (1777) for user image uploads
  - **Default Images**: Pre-installed coffee, burger, and pizza icons for restaurant use (currently 1 PNG test image available)
  - **UI Integration**: Dropdown selection from available images in zone properties dialog
  - **Image Rendering**: Full multi-format image loading and display with automatic scaling and centering, proper button state handling with consistent image colors (prevents selection tinting), forced redraw on touch to maintain image appearance, simplified layering (image → text overlay) for clean visual presentation on menu items, qualifiers, and tables
  - **Intelligent Scaling**: Images automatically stretch to fill button dimensions, adjusting aspect ratio to match button width and height; small images scale up to fill available space
  - **Transparency Support**: PNG alpha channels handled with background color blending (simplified approach)
  - **Dependencies**: Optional libpng, libjpeg, libgif support with graceful fallback
  - **Protocol Enhancement**: Added `TERM_PIXMAP` command for client-server image rendering
  - **Architecture**: Moved image_path field to base ButtonZone class for universal inheritance
  - Files added: `zone/button_zone.{hh,cc}` (ImageButtonZone), `term/term_dialog.{hh,cc}`, `term/layer.{hh,cc}`, `main/hardware/terminal.{hh,cc}`, `assets/default_images/*.xpm`, `assets/default_images/*.png`
  - Files modified: `zone/pos_zone.{hh,cc}`, `main/ui/labels.cc`, `CMakeLists.txt`, `src/network/remote_link.hh`, `term/term_view.{hh,cc}`, `term/layer.cc`

### Fixed
- **Image Display Toggle Changed to Per-Terminal**: Changed `toggleimages` command from global to per-terminal setting
  - Moved `show_button_images` from Settings (global) to Terminal class (per-terminal)
  - Each terminal now independently controls its image display mode
  - Toggle only affects the terminal where the button is pressed, not all terminals
  - Affects all button types: ButtonZone, ItemZone (menu items), QualifierZone (modifiers), and TableZone
  - Zones check `term->show_button_images` flag before rendering images
  - Mark all zones as needing update when toggle is triggered for immediate visual feedback
  - Preserves backward compatibility by reading deprecated setting from Settings file
  - Files modified: `main/hardware/terminal.{hh,cc}`, `zone/button_zone.cc`, `zone/order_zone.cc`, `zone/table_zone.cc`, `main/data/settings.{hh,cc}`
- **Self-Order Terminal Navigation and System Operations**: Comprehensive fixes for Customer user navigation, check management, and system operations
  - **Issue 1 - Regular Employee Navigation**: Regular employees were being sent to page -2 (self-order page) when clicking "Restart" button or using "Return To The Starting Page" jump option
    - **Root Cause**: Navigation functions were using `page_variant` setting without checking user type
    - **Fix**: 
      - Added `GetDefaultLoginPage()` helper function that checks if user is "Customer" - only Customer user goes to page -2, all others go to page -1
      - Updated `CancelOrders()` to use `GetDefaultLoginPage()` instead of hardcoded page -2
      - Updated `HomePage()` to skip page_variant logic for regular employees on FASTFOOD/NORMAL terminals
      - Updated `LogoutUser()` to call `GetDefaultLoginPage()` before clearing user context
  - **Issue 2 - Customer Navigation to Tables**: Customer user was incorrectly navigated to table pages when clicking interactable buttons
    - **Root Cause**: `HomePage()` was falling back to `FirstTablePage()` when page -2 wasn't found
    - **Fix**: Added early return in `HomePage()` to always send Customer user directly to page -2
  - **Issue 3 - Unclosed Checks**: Checks remained open when Customer canceled or left without completing order
    - **Root Cause**: `CancelOrders()` and `StoreCheck()` were keeping checks for SELFORDER terminals
    - **Fix**: 
      - Updated `CancelOrders()` to destroy checks for Customer user when canceling
      - Updated `StoreCheck()` to destroy empty checks for Customer user
      - Regular employees' checks are still preserved
  - **Issue 4 - Blocked System Operations**: Customer being always logged in prevented shutdown/restart/end-of-day operations
    - **Root Cause**: `TermsInUse()` and `OtherTermsInUse()` counted Customer user, preventing operations when count > 0
    - **Fix**: 
      - Updated `TermsInUse()` to exclude Customer user from count
      - Updated `OtherTermsInUse()` to exclude Customer user from count
      - Customer user no longer blocks shutdown, restart, end-of-day, or credit card settlement operations
  - **Impact**: 
    - Regular employees correctly return to page -1 (login page)
    - Customer user stays on page -2 (self-order page) and never navigates to table pages
    - Incomplete orders are automatically cleaned up when Customer cancels or leaves
    - System operations (shutdown/restart/end-of-day/CC settlement) work correctly even with Customer logged in
  - Files modified: `main/hardware/terminal.{hh,cc}`, `zone/order_zone.cc`

- **Enhanced Black Text Readability**: Improved text contrast by using white shadows for dark/black text colors
  - **Issue**: Black text with dark shadows created poor readability on various backgrounds
  - **Fix**: Modified `GenericDrawStringXftEmbossed` and `GenericDrawStringXftWithShadow` to use white shadows for dark colors (RGB < 1000)
  - **Impact**: Black and dark text now has much better readability with white outline/shadow effects
  - Files modified: `src/core/generic_char.cc`
- **Hardware Button Display Sending**: Fixed broken signal routing for "Hardware" button types that send to display terminals
- **Thermal Printer Receipt Centering**: Fixed receipt content alignment on thermal printers
  - Changed Epson printer width from 33 to 40 characters for proper centering
  - Resolves issue where receipt content appeared left-aligned instead of centered
  - Files modified: `main/hardware/printer.cc`
- **Status Function Conflicts**: Resolved compilation errors caused by STATUS macro conflicts
  - Renamed `Check::Status()` → `Check::GetStatus()` for method naming consistency
  - Renamed `Drawer::Status()` → `Drawer::GetStatus()` to avoid preprocessor conflicts
  - Renamed `Credit::Status()` → `Credit::GetStatus()` for uniform API design
  - Updated all function calls throughout codebase (60+ locations across multiple files)
  - Fixed variable scoping issue in Frame function (`r.h` → `rg.h`)
  - Files modified: `main/business/check.{hh,cc}`, `main/hardware/drawer.{hh,cc}`, `main/data/credit.{hh,cc}`, and related calling files

### Changed
- **String Performance Optimizations and Modernization (2025-11-21)**
  - **Performance Improvements**: Comprehensive string operation optimizations across the codebase
    - **MakeFileName optimization**: Eliminated unnecessary string copies by filtering characters directly into output buffer
    - **WriteLR optimization**: Replaced inefficient space-filling loops with `memset()` and direct buffer operations
    - **Reference list building**: Replaced multiple `safe_format()` + `strcat()` calls with direct `snprintf()` buffer operations
    - **Translation caching**: Cached repeated `Translate()` calls in credit processing to avoid redundant lookups
  - **String Safety Modernization**:
    - Replaced all unsafe `strncpy()`, `sprintf()`, and `strcat()` operations with safe alternatives
    - Implemented bounds-checked string operations throughout hardware and business modules
    - Enhanced error checking for all string formatting operations
  - **Memory Efficiency**: Reduced allocations and improved memory access patterns for string operations
  - **Impact**: Significant performance improvements in printing, UI rendering, and data processing with enhanced safety
  - **Files modified**: `main/hardware/printer.cc`, `main/hardware/terminal.cc`, `main/hardware/cdu.cc`, `main/data/credit.cc`, `main/business/customer.cc`, `main/business/employee.cc`

- **Embossed Text Rendering**: Made embossed text effect more subtle and less overwhelming
  - **Refinement**: Modified `GenericDrawStringXftEmbossed` to use minimal white outline for better text readability
  - **Visual Effect**: Embossed text now appears with barely visible white outline above main text only
  - **Implementation**: Draws single white copy at top position with full opacity for subtle 3D effect
  - **Impact**: Less intrusive embossed appearance that preserves text color visibility while maintaining professional look
  - Files modified: `src/core/generic_char.cc`
- **Security Policy Update**: Updated SECURITY.md to only support the latest version (25.03.x) instead of multiple versions
  - Removed support for older versions (25.02.x, 25.01.x, 25.00.x)
  - Updated version support policy to only maintain security updates for the current stable release
  - Changed end-of-life policy to anything below 25.03.x
- **Button Type Editor Reorganization**: Flattened button type hierarchy by promoting menu item subtypes to top-level options
  - **UI Simplification**: Replaced "Menu" → "Menu Type" submenu with direct selection of "Menu Item", "Modifier", "Non-Tracking Modifier", "Menu Item + Substitute", "Priced By Weight", "Event Admission"
  - **New Zone Types**: Added ZONE_ITEM_NORMAL, ZONE_ITEM_MODIFIER, ZONE_ITEM_METHOD, ZONE_ITEM_SUBSTITUTE, ZONE_ITEM_POUND, ZONE_ITEM_ADMISSION constants
  - **Dialog Enhancement**: Automatic itype assignment based on selected button type, removed submenu navigation for better UX
  - **Backward Compatibility**: Maintains existing ZONE_ITEM functionality while providing streamlined editor interface
  - Files modified: `zone/pos_zone.{hh,cc}`, `main/ui/labels.cc`, `term/term_dialog.cc`

### Removed
- **Debug Script Cleanup**: Removed debug_viewtouch.sh debugging script from the workspace

## [v25.03.0] - 2025-10-25
### Added
- **DataPersistenceManager System**: Comprehensive data persistence and integrity management system
  - **Singleton-based Data Persistence Manager** with thread-safe operations and configurable settings
  - **Critical Data Monitoring**: Tracks and validates checks, settings, archives, terminals, and CUPS communication
  - **Intelligent Auto-Save**: Only saves when data is actually dirty, respects user workflow by skipping during edit mode
  - **Error Recovery Mechanisms**: Automatic CUPS service restart, consecutive failure tracking, component-specific recovery
  - **Performance Metrics**: Detailed operation timing, success rate tracking, and comprehensive performance reports
  - **Data Integrity Verification**: File integrity checks, data consistency validation, checksum generation
  - **Training Check Filtering**: Completely excludes training checks from all persistence operations (save, validate, backup)
  - **Enhanced Logging**: Component-based error categorization, log size management, detailed operation reporting
  - **Configuration Management**: Runtime configuration updates with validation and limits
  - **Safe System Operations**: Timeout-protected command execution, proper file operations, memory safety improvements
  - New files: `src/core/data_persistence_manager.{hh,cc}`
  - Integration points: Check save operations, system initialization, periodic tasks, shutdown procedures

- **Editor Settings Separation**: Split the "Editor Settings" functionality into two distinct buttons for better organization
  - **Editor Settings** button now contains only developer authentication and calculation settings:
    - Editor's Password (9-digit numeric field)
    - Minimum Password Length (2-digit field)
    - Multiply (2-digit field)
    - Add or Subtract (5-digit field for price calculations)
  - **Revenue Groups** button contains all food category revenue group settings:
    - All menu family groups (Appetizer, Burger, Lunch Entree, etc.) with sales group dropdowns
    - Each category can be assigned to different sales groups for reporting purposes
  - New zone type: `ZONE_REVENUE_GROUPS` (96) with corresponding `RevenueGroupsZone` class
  - Updated all translation files with "Revenue Groups" localizations
  - Files modified: `zone/pos_zone.{hh,cc}`, `zone/settings_zone.{hh,cc}`, `main/ui/labels.cc`, and all translation files

## [v25.02.0] - 2025-10-24
### Fixed
- **Memory Management Modernization**: Comprehensive modernization of zone management classes using C++17/20 smart pointers
  - Replaced raw `new`/`delete` with `std::unique_ptr` for automatic memory management in `ZoneDB`, `Page`, and `Zone` classes
  - Updated `ZoneDB::Copy()`, `Page::Copy()`, and `Zone::Copy()` methods to return `std::unique_ptr` instead of raw pointers
  - Modernized `Control::zone_db` and `Terminal::zone_db` with smart pointer ownership semantics
  - Eliminated potential memory leaks and crashes from manual memory management
  - Enhanced exception safety with RAII patterns throughout the zone system
  - Fixed compilation errors related to ownership transfer and pointer management
  - Maintained full backward compatibility while improving code safety and maintainability
  - Files modernized: `zone/zone.{hh,cc}`, `zone/pos_zone.{hh,cc}`, `zone/button_zone.{hh,cc}`, `zone/order_zone.{hh,cc}`, `zone/chart_zone.{hh,cc}`, `zone/dialog_zone.{hh,cc}`, `zone/table_zone.{hh,cc}`, `zone/settings_zone.{hh,cc}`, `main/data/manager.{hh,cc}`, `main/hardware/terminal.{hh,cc}`
- **Credit Card Fee Percentage Calculation**: Fixed percentage-based credit card fees to properly calculate amounts
  - Credit Card Fee (Percent) tender type now correctly calculates fees as percentage of raw sales
  - Added percentage calculation logic in payment processing loop using `raw_sales * percentage_amount`
  - Maintains consistency with how gratuity percentages are calculated in the system
  - Files modified: `main/business/check.cc`

### Added
- **Modern C++ Libraries Integration**: Added three professional C++ libraries to improve code quality and developer experience
  - **spdlog (v1.13.0)**: High-performance async logging library with multiple sinks (file, console, syslog)
    - Automatic log rotation (10MB files, keeps 5 files)
    - Thread-safe operations with zero overhead when disabled
    - Format string support with type-safe arguments
    - Replaces mix of `logmsg()`, `ReportError()`, and custom logging
    - New wrapper: `src/utils/vt_logger.hh` and `vt_logger.cc`
    - Usage: `vt::Logger::info("Check #{} - Total: ${:.2f}", id, total)`
    - Logs stored in `/var/log/viewtouch/viewtouch.log`
  - **nlohmann/json (v3.11.3)**: Modern JSON library for configuration files
    - STL-like interface with intuitive syntax
    - Type-safe conversions and nested value access
    - Automatic backups before saving configs
    - New helper: `src/utils/vt_json_config.hh` and `vt_json_config.cc`
    - Usage: `cfg.Get<double>("tax.food", 0.07)` with nested keys
    - Replaces custom INI parsers for new configuration files
  - **magic_enum (v0.9.5)**: Compile-time enum reflection without macros
    - Automatic enum-to-string conversions: `vt::EnumToString(PaymentType::CreditCard)` → "CreditCard"
    - String-to-enum parsing with optional return type
    - Get all enum values, names, and counts at compile-time
    - Zero runtime overhead (header-only, compile-time reflection)
    - New utilities: `src/utils/vt_enum_utils.hh`
    - Backwards compatible C-style array generation
  - **CMake Integration**: All libraries fetched automatically via FetchContent
  - **Comprehensive Documentation**: Added `docs/MODERN_CPP_LIBRARIES.md` with examples and best practices
  - **Demo Application**: Created `src/utils/modern_cpp_example.cc` demonstrating all three libraries
  - **Benefits**:
    - **Better Logging**: Async performance, automatic rotation, structured output
    - **Modern Configs**: JSON format easier to read/edit than custom binary formats
    - **Cleaner Enums**: No more manual `const char* names[]` arrays to maintain
    - **C++17/20 Alignment**: Supports modern development practices
    - **Professional Tools**: Battle-tested libraries used by thousands of projects
- **Active Production Integrations**:
  - **vtpos** (`loader/loader_main.cc`) - Startup logging with version info
  - **vt_main** (`main/data/manager.cc`) - System initialization, socket connections, data path logging
  - **vt_term** (`term/term_main.cc`) - Terminal startup, display connection logging
  - **Check Processing** (`main/business/check.cc`) - Check save/close operations with details
  - **Credit Cards** (`main/data/credit.cc`) - Payment transactions, authorizations, voids, refunds
- **Video Display Timing System** 🚧 **UNDER DEVELOPMENT**: Enhanced kitchen/bar video displays with intelligent color coding and alerts
  - **Progressive Color Alerts**: Orders automatically change color based on preparation time
    - **Warning State (Yellow)**: Orders waiting 10+ minutes (configurable)
    - **Alert State (Red)**: Orders waiting 20+ minutes (configurable)
    - **Critical State (Flashing)**: Orders waiting 30+ minutes (configurable)
  - **Modifier Inheritance**: Order modifiers (extra cheese, no onions, etc.) always use distinct colors from main items
    - **Consistent Differentiation**: Modifiers display in red for normal orders, darker shades for alerts (yellow→orange, red→dark red)
    - **Enhanced Readability**: Clear visual separation between menu items and modifications at all times
  - **Configurable Settings**: Restaurant managers can customize timing thresholds and colors
    - **Settings Panel**: Added "Kitchen Video Order Alert Settings" in system configuration
    - **Color Customization**: Choose from 21 different colors for each alert state
    - **Time Thresholds**: Adjustable warning/alert/flash intervals in minutes
  - **Real-time Updates**: Visual effects update dynamically as orders age
  - **Kitchen Efficiency**: Prevents orders from being forgotten with visual urgency indicators
  - **Crash Prevention**: Added robust NULL pointer checks and safety validation
  - **Improved Readability**: Changed flashing behavior from hiding text to alternating colors for better visibility during order preparation
  - **Files Modified**:
    - `main/data/settings.{hh,cc}` - Added timing and color configuration settings
    - `zone/settings_zone.cc` - Added configuration UI for video timing settings
    - `zone/report_zone.{hh,cc}` - Added blinking state management for flashing alerts
    - `main/business/check.cc` - Implemented color logic and modifier inheritance
  - **Files Created**:
    - `src/utils/vt_logger.{hh,cc}` - Logging wrapper around spdlog
    - `src/utils/vt_json_config.{hh,cc}` - JSON configuration helper
    - `src/utils/vt_enum_utils.hh` - Enum reflection utilities (header-only)
    - `src/utils/modern_cpp_example.cc` - Comprehensive usage examples
    - `main/data/settings_enums.hh` - Modernized enums (DrawerMode, ReceiptPrint, TimeFormat, etc.)
    - `main/data/terminal_config_example.cc` - Working JSON config example (can generate templates)
    - `docs/MODERN_CPP.md` - **Complete guide** (API reference, examples, integration guide, all in one file)
  - **Files Modified**:
    - `CMakeLists.txt` - Added FetchContent declarations and library linking for zone and vtcore
    - `loader/loader_main.cc` - Integrated spdlog logging at startup
    - `main/data/manager.cc` - Full logging integration (startup, sockets, system init, shutdown)
    - `term/term_main.cc` - Terminal logging (startup, connections, errors)
    - `main/business/check.cc` - Check operation logging (save, close with user/table info)
    - `main/data/credit.cc` - Payment logging (auth, void, refund with amounts/approvals)
    - `zone/settings_zone.cc` - Active magic_enum integration (5 settings using modern enums)

- **Bouncing DVD-Style Screensaver**: Updated screensaver with animated "ViewTouch 35 Years In Point Of Sales" text
  - **DVD Logo Animation**: Text bounces around the screen like the classic DVD logo screensaver
  - **Edge Detection**: Text reverses direction when it hits screen edges for continuous smooth animation
  - **Message Display**: Large white text (34-point Times Bold) rendered with antialiasing over black background
  - **Position Tracking**: Uses floating-point coordinates for smooth sub-pixel movement
  - **Auto-Reset**: Position resets to center when screensaver deactivates and user returns
  - **High Quality Rendering**: Uses Xft font rendering for smooth, professional appearance
  - **Files Modified**:
    - `term/term_view.cc` - Implemented bouncing animation in DrawScreenSaver() with position/velocity tracking
    - `term/term_view.hh` - Added ResetScreenSaver() function declaration
  - **Benefits**:
    - **Brand Recognition**: Celebrates 35 years of ViewTouch in point of sales
    - **Engaging Animation**: Eye-catching bouncing effect keeps screen interesting during idle periods
    - **Nostalgia Factor**: Classic DVD screensaver style familiar to users
    - **Professional Appearance**: Clean, elegant screensaver with smooth motion

- **Menu Item Type Filtering in Review & Edit Menu Item Properties**: Enhanced the ItemListZone to allow filtering by specific menu item types
  - **Filter Buttons**: Added 7 clickable filter buttons at the top of the page (All, Items, Modifiers, Non-Track, Item+Sub, By Weight, Admission)
  - **Color-Coded Display**: Each of the 6 menu item types now has a unique color for easy visual differentiation:
    - Regular Items: Default/Black
    - Modifiers: Dark Blue
    - Non-Tracking Modifiers: Dark Green
    - Items + Substitute: Dark Red
    - Priced By Weight: Purple
    - Event Admission: Orange
  - **Smart Filtering**: When a filter is active, only items of that type are displayed, record count updates accordingly, and navigation works within the filtered set
  - **Visual Indicators**: Active filter button is highlighted, providing clear feedback on current filter state
  - **Files Modified**:
    - `zone/inventory_zone.hh` - Added filter_type member, Signal/Mouse method overrides, and helper methods for color/name mapping
    - `zone/inventory_zone.cc` - Implemented filtering logic in Render, RecordCount, LoadRecord, ListReport, and mouse click detection
  - **Benefits**:
    - **Reduced Clutter**: Users can focus on one type of menu item at a time without distraction from other types
    - **Faster Workflow**: No need to scroll through all items to find specific types; filtering shows only relevant items
    - **Better Organization**: Useful for viewing and editing specific categories like only modifiers or only admission tickets
    - **Maintains Compatibility**: All existing functionality works as before when "All" filter is active (default)

- **Modern C++17/20 Improvements to Check Management System**: Comprehensive modernization of the core check handling classes
  - **Memory Management**: Replaced raw `new`/`delete` with `std::make_unique<>()` and smart pointers for better memory safety
  - **Constructor Modernization**: Converted all constructors to use member initializer lists for improved performance and initialization order
  - **Null Safety**: Replaced all `NULL` with `nullptr` for better type safety and function overloading support
  - **Const Correctness**: Added const qualifiers to member functions that don't modify object state, with both const and non-const overloads for API compatibility
  - **Modern Headers**: Added `#include <memory>` for smart pointer support
  - **Files Enhanced**:
    - `main/business/check.cc` - Comprehensive modernization of Check, SubCheck, Order, and Payment classes
    - `main/business/check.hh` - Updated class definitions with modern C++ features and const correctness
  - **Benefits**:
    - **Memory Safety**: Smart pointers prevent memory leaks and provide automatic cleanup
    - **Performance**: Member initializer lists are more efficient than constructor body assignments
    - **Type Safety**: `nullptr` prevents function overloading ambiguities and provides clearer intent
    - **Maintainability**: Const correctness makes code intent clearer and prevents accidental modifications
    - **Modern Compliance**: Code now follows C++17/20 best practices while maintaining 100% backward compatibility
    - **Robustness**: Improved error handling and memory management increase system stability

### Fixed
- **Auto Receipt Printing "Never" Setting**: Fixed issue where auto receipt printing always occurred even when set to "Never"
  - Root cause: ReceiptPrintType enum values were incorrectly mapped, causing RECEIPT_NONE (0) to display as "On Send" instead of "Never"
  - Fixed enum ordering: Never = 0, OnSend = 1, OnFinalize = 2, OnBoth = 3 to match RECEIPT_* constants
  - Updated ReceiptPrintValue/ReceiptPrintName arrays to match new enum order
  - Files modified: `main/data/settings_enums.hh`, `main/data/settings.cc`
- **Remote Display Graceful Shutdown**: Fixed issue where remote displays don't know when the ViewTouch client application exits
  - Added `Control::KillAllTerms()` function that sends `TERM_DIE` commands to all remote terminals before shutdown
  - Modified `EndSystem()` to use graceful termination instead of immediate process killing
  - Remote displays now receive shutdown notification and exit cleanly instead of attempting reconnection
  - Eliminates the 2-minute delay where remote displays try to reconnect after server shutdown
  - Files modified: `main/data/manager.{hh,cc}` - Added graceful terminal termination system
- **Kitchen Video Print Method "Matched" Empty Report Error**: Fixed issue where setting "Kitchen Video Print Method" to "Matched" caused video targets to break with "ReportRender: can't render report with empty body" error
  - **Root Cause**: `PrintWorkOrder()` method was designed for printer output and would return early when no orders needed printing, but for video display it should always show check information
  - **Solution**: Modified `PrintWorkOrder()` to continue execution for video display mode (`rzone != nullptr`) even when no orders match the video target
  - **Impact**: Video targets now display properly with "Matched" setting, showing check headers even when no orders are assigned to specific video targets
  - **Files Modified**: `main/business/check.cc` - Enhanced `PrintWorkOrder()` method with video display handling
- **Self-Order Button Differentiation**: Fixed issue where `quickdinein` and `quicktogo` buttons on self-order page didn't work correctly
  - **Problem**: Buttons were calling wrong check types (`CHECK_DINEIN`, `CHECK_TOGO`) instead of self-order variants
  - **Solution**: Updated message handling to use correct self-order check types (`CHECK_SELFDINEIN`, `CHECK_SELFTAKEOUT`)
  - **Impact**: Self-order buttons now properly differentiate between dine-in and take-out orders as intended
  - **Files Modified**: `zone/button_zone.cc` - Fixed message handling in `MessageButtonZone::Signal()` method

### Added
- **Enhanced Touchscreen Input System**: Comprehensive improvements to ViewTouch's touchscreen input handling
  - **Enhanced Touch Event Structure**: Added `TouchEvent` struct with timestamp, pressure, and touch ID support for better touch tracking
  - **Advanced Calibration System**: Implemented `TouchCalibration` structure with offset, scale, and rotation support for improved accuracy
  - **Gesture Recognition**: Added support for touch gestures (tap, double-tap, long-press, swipe) with configurable sensitivity
  - **Multi-touch Support**: Enhanced touchscreen to handle multiple simultaneous touches with proper event tracking
  - **Touch Event History**: Added event buffering and history tracking for gesture recognition and improved responsiveness
  - **Performance Optimizations**: Implemented asynchronous I/O operations and touch event buffering to prevent UI blocking
  - **Touch Feedback**: Added visual and haptic feedback options for better user experience
  - **Enhanced Error Handling**: Improved error recovery and validation with comprehensive logging
  - **Configuration Options**: Added touchscreen settings for gestures, multi-touch, pressure sensitivity, and timeout controls
  - **Files Enhanced**:
    - `term/touch_screen.hh` - Added new touch event structures and enhanced API methods
    - `term/touch_screen.cc` - Implemented comprehensive touchscreen improvements and new functionality
    - `term/term_view.cc` - Enhanced touch event processing with improved callback handling
  - **Benefits**:
    - **Better Accuracy**: Advanced calibration system provides more precise touch detection
    - **Improved Responsiveness**: Event buffering and async I/O prevent UI lag during touch operations
    - **Enhanced UX**: Gesture support and touch feedback create more intuitive interactions
    - **Robust Operation**: Better error handling and recovery mechanisms improve system stability
    - **Future-Ready**: Modern touch event system supports advanced touchscreen features and hardware

### Reverted
- **Dynamic Scaling System**: Reverted universal dynamic scaling system for better UI stability
  - Removed dynamic scaling functions (`CalculateScaleFactors()`, `ScaleX()`, `ScaleY()`, `ScaleW()`, `ScaleH()`, `ScaleFontSize()`)
  - Restored original hardcoded page dimensions in `Layer::BlankPage()` for consistent rendering
  - Reverted `MAX_SCREEN_WIDTH` and `MAX_SCREEN_HEIGHT` limits for better compatibility
  - Fixed conditional button rendering bugs caused by coordinate system mismatches
  - Improved UI stability and alignment across different display resolutions
  - Files reverted: `term/layer.cc`, `term/term_view.hh`, `term/term_view.cc`

### Changed
- **Item Name Character Limit Increase**: Increased the character limit for item names from 32 to 100 characters
  - **Enhanced Item Name Flexibility**: Users can now create longer, more descriptive item names up to 100 characters
  - **UI Field Update**: Modified `ItemListZone::AddFields()` in `zone/inventory_zone.cc` to support longer names
  - **Backward Compatibility**: Existing item names continue to work unchanged, only new items benefit from the extended limit
  - **Benefits**:
    - **Better Item Descriptions**: Restaurants can use more detailed, descriptive names for menu items
    - **Improved Clarity**: Longer names reduce ambiguity and improve customer understanding
    - **Future-Proofing**: Supports longer item names as menu complexity grows over time
    - **No Breaking Changes**: Existing shorter item names work exactly as before
- **Error Handler Modernization**: Comprehensive refactoring of unified error handling framework with modern C++17/20 features
  - **Modern C++ Features Applied**:
    - **String Handling**: Replaced `const std::string&` with `std::string_view` for better performance and zero-copy operations
    - **Thread Safety**: Upgraded from `std::mutex` to `std::shared_mutex` for better read performance with concurrent access
    - **Singleton Pattern**: Modernized with `std::once_flag` and `std::call_once` for thread-safe initialization
    - **Smart Pointers**: Used `std::make_unique` instead of raw `new` for automatic memory management
    - **Move Semantics**: Added `std::move` for efficient object transfers and proper RAII
    - **Constexpr Functions**: Made utility functions `constexpr` where possible for compile-time evaluation
    - **Noexcept Specifications**: Added `noexcept` to appropriate methods for better optimization
    - **Enum Improvements**: Used `std::uint8_t` as underlying type for better memory efficiency
    - **Rule of Five**: Explicitly defined copy/move semantics with deleted copy operations
  - **API Enhancements**:
    - **Modern Constructor**: Updated `ErrorInfo` constructor to use `string_view` parameters with default values
    - **Enhanced Methods**: All error reporting methods now use `string_view` for better performance
    - **Memory Optimization**: Added `reserve()` calls to prevent unnecessary reallocations
    - **Shared Mutex**: Used `std::shared_lock` for read operations, `std::unique_lock` for writes
  - **Benefits**:
    - **Performance**: `string_view` eliminates unnecessary string copies, `shared_mutex` allows concurrent reads
    - **Memory Safety**: Smart pointers and RAII prevent memory leaks
    - **Thread Safety**: Modern synchronization primitives are more efficient than manual mutex locking
    - **Compile-time Optimization**: `constexpr` functions can be evaluated at compile time
    - **API Compatibility**: All existing code using the error handler continues to work unchanged
  - **Files Modernized**:
    - `src/core/error_handler.hh` - Header file with modern C++ features and improved API
    - `src/core/error_handler.cc` - Implementation with modern patterns and thread-safe singleton
  - **Backward Compatibility**: 100% maintained - all existing error handling code continues to work without changes

- **Comprehensive C++17/20 Modernization - Phase 1**: Systematic modernization of core codebase using modern C++ features
  - **Files Modernized**: 16 files (990 insertions, 817 deletions)
  - **SHA-1 Cryptographic Hash (`external/core/sha1.cc/hh`)**: 
    - Converted C-style struct to modern C++ class with proper encapsulation
    - Replaced C arrays with `std::array<uint32_t, 5>` and `std::array<uint8_t, 64>`
    - Converted preprocessor macro to `constexpr` function for type-safe circular shift
    - Added move semantics (deleted copy operations, defaulted move)
    - Made helper functions private class methods for better encapsulation
    - Added C-style wrapper functions for backward compatibility
    - Used typed enum `SHA1ErrorCode` instead of anonymous enum
  - **List Template Classes (`src/core/list_utility.hh`)**: 
    - Modernized `SList` and `DList` templates with `typename T` instead of `class type`
    - Replaced all `NULL` with `nullptr` (200+ occurrences)
    - Added move semantics to both template classes
    - Deleted copy operations for safer resource management
    - Added `[[nodiscard]]` attributes to all accessor methods
    - Changed boolean methods to return `bool` instead of `int`
    - Added member initializers and `explicit` constructors
  - **Protocol Constants (`src/network/remote_link.hh`)**: 
    - Converted 60+ macros to `constexpr` constants in organized namespaces:
      - `TerminalProtocol` - Terminal command constants
      - `ServerProtocol` - Server message constants
      - `PrinterProtocol` - Printer command constants
      - `OperationMode` - UI mode constants
      - `WindowFrame` - Window flag constants
    - Maintained 100% backward compatibility with preprocessor macros
    - Modernized `CharQueue` class with move semantics and member initializers
  - **Logger System (`src/core/logger.cc/hh`)**: 
    - Replaced global C array with `std::array<char, 1025>`
    - Replaced static `int` flag with `bool` for initialization state
    - Added anonymous namespace for internal linkage
    - Added `noexcept` specifications and format checking attributes
    - Modernized with C++ headers (`<cstdarg>` vs `<stdarg.h>`)
  - **Utility Classes (`src/utils/utility.cc/hh`)**: 
    - Replaced macros with `constexpr` constants
    - Modernized `RegionInfo` class with member initializers
    - Made methods `constexpr` where applicable
    - Added `[[nodiscard]]` attributes to all getters
    - Changed boolean return types from `int` to `bool`
    - Used member initializer lists in constructors
  - **Basic Types (`src/core/basic.hh`)**: 
    - Replaced all `typedef` with modern `using` type aliases
    - Modernized template functions (`Max`, `Min`, `Abs`) with `typename T`
    - Added `[[nodiscard]]` and `noexcept` to all template functions
    - Moved string constants from macros to `constexpr` (STRSHORT, STRLENGTH, STRLONG)
  - **Loader Application (`loader/loader_main.cc`)**: 
    - Replaced C arrays with `std::array` for Message and KBInput buffers
    - Replaced unsafe `strcpy` with bounds-checked `strncpy`
    - Replaced `NULL` with `nullptr` throughout
    - Added `static_cast` for explicit type conversions
    - Improved buffer safety and overflow protection
  - **Socket/Email Classes (`src/network/socket.cc/hh`)**: 
    - Modernized `Line` and `Email` classes with move semantics
    - Added member initializers and `[[nodiscard]]` attributes
    - Added `noexcept` specifications to appropriate methods
    - Improved const-correctness throughout
  - **Version Information (`version/vt_version_info.cc/hh`)**: 
    - Added `[[nodiscard]]` attributes to prevent ignored return values
    - Added `noexcept` specifications to all functions
    - Used `const std::string&` returns for efficiency
    - Eliminated unnecessary string copies
  - **Benefits**:
    - **Type Safety**: Stronger compile-time guarantees with `nullptr`, `constexpr`, typed enums
    - **Memory Safety**: Bounds-checked arrays, safe string operations, RAII compliance
    - **Performance**: Compile-time evaluation, move semantics, `noexcept` optimizations
    - **Maintainability**: Modern idioms, namespaces, clear intent with attributes
    - **Compatibility**: 100% backward compatible - all existing code continues to work
    - **Code Quality**: 70+ functions marked `noexcept`, 50+ marked `[[nodiscard]]`, 6 classes with move semantics

- **Generic Character and Text Rendering Modernization**: Comprehensive refactoring of text rendering functions with modern C++ features
  - **generic_char.hh/cc**: Modernized text drawing API with C++20 `std::span` for safer buffer handling
    - Replaced raw pointer + length parameters with type-safe `std::span<const genericChar>` for all draw functions
    - Added `MakeGenericCharSpan()` helper for seamless conversion from legacy pointer/length API
    - Provided backward-compatible inline overloads to maintain existing call sites
    - Enhanced null pointer safety with proper validation in all drawing functions
    - Added `[[maybe_unused]]` and `[[nodiscard]]` attributes for better compile-time safety
    - Modernized internal helpers with `constexpr` and `noexcept` specifications
    - Replaced global variable `is_wide_char` with scoped `g_isWideChar` in anonymous namespace
    - Improved function parameter names for better code documentation
    - Used `#pragma once` for modern header guard style
  - **data_file.cc**: Fixed character literal handling for cross-compiler compatibility
    - Replaced problematic backslash character literal `'\\'` with safe `constexpr` definition
    - Prevents potential issues with different compiler interpretations of escape sequences
    - Ensures consistent behavior across GCC, Clang, and other C++ compilers
  - **Benefits**:
    - **Memory Safety**: `std::span` provides bounds checking and prevents buffer overruns
    - **Type Safety**: Compile-time enforcement of buffer boundaries and null checks
    - **Performance**: Zero-overhead abstractions with inline overloads and constexpr helpers
    - **Maintainability**: Clearer API with modern C++ idioms while maintaining backward compatibility
    - **Compiler Portability**: Fixed character literal issues for consistent cross-platform behavior

- **Core File I/O Modernization**: Comprehensive refactoring of core data and configuration file classes
  - **ConfFile Class (conf_file.hh/cc)**: Modernized INI file I/O library with C++17/20 features
    - Replaced C-style constants with `constexpr std::string_view` for compile-time evaluation
    - Enhanced API with `std::optional<std::string>` return type for safer value retrieval (`TryGetValue()`)
    - Added `[[nodiscard]]` attributes to prevent ignoring important return values
    - Improved const correctness with `noexcept` specifications
    - Replaced old naming convention (`CommentIndicators`) with modern style (`comment_indicators`)
    - Enhanced function parameters with `std::string_view` for better performance
    - Used default member initialization for cleaner code
    - Added `= default` for special member functions where appropriate
  - **DataFile Classes (data_file.hh/cc)**: Modernized binary data file I/O system
    - Replaced C macro `BLOCKSIZE` with `constexpr std::size_t DataFileBlockSize`
    - Converted to default member initialization (`fp{nullptr}`, `old_format{false}`)
    - Enhanced type safety by using `bool` instead of `int` for boolean flags
    - Added `[[nodiscard]]` attributes to critical query functions
    - Improved const correctness with `noexcept` specifications
    - Replaced `NULL` with `nullptr` throughout
    - Used `std::array` for fixed-size buffers instead of C-style arrays
    - Separated file pointer types (`gzFile gz_fp`, `std::FILE* file_fp`) for clarity
    - Added `is_open()` const noexcept member function for better API
    - Enhanced destructors with proper resource management
  - **Printer Classes (printer.hh)**: Enhanced virtual function declarations
    - Replaced `virtual` keyword with `override` for better compile-time checking
    - Added `[[maybe_unused]]` attribute to intentionally unused parameters
    - Improved code clarity and prevented accidental virtual function hiding
  - **Business and Hardware Classes**: Consistent modernization across multiple modules
    - `account.hh/cc`: Enhanced const correctness and modern C++ usage
    - `employee.hh`: Improved type safety with modern features
    - `drawer.hh/cc`: Modernized with override keywords and better parameter handling
    - `report.hh`: Enhanced with modern C++ patterns
  - **Benefits**:
    - **Type Safety**: Better compile-time error detection with modern C++ features
    - **Performance**: Compile-time evaluation with constexpr and string_view reduces runtime overhead
    - **Maintainability**: Cleaner, more readable code with modern C++ idioms
    - **Safety**: [[nodiscard]] and noexcept help prevent bugs and improve optimization
    - **API Improvement**: std::optional provides safer value retrieval without exceptions
    - **Code Quality**: Consistent modern C++ style throughout core infrastructure

### Added
- **Credit Card Fee Tender Types**: Two new tender button types for processing credit card fees
  - Added `TENDER_CREDIT_CARD_FEE_DOLLAR` (25) for fixed dollar amounts that add to transaction total
  - Added `TENDER_CREDIT_CARD_FEE_PERCENT` (26) for percentage amounts that add to transaction total
  - **Both add to transaction total** instead of being treated as payment received (unlike regular tenders)
  - Dollar amounts: cents precision (e.g., 35 = $0.35, 100 = $1.00)
  - Percentage amounts: supports decimal percentages (e.g., 199 = 1.99%, 250 = 2.5%)
  - Clear separation between dollar and percentage fee types for user clarity
  - Integrated with existing tender system and payment processing
  - Added to UI tender type selection dropdown as "Credit Card Fee (Dollar)" and "Credit Card Fee (Percent)"
  - Files modified: `main/business/check.{hh,cc}`, `main/data/settings.cc`, `main/ui/labels.cc`, `zone/payment_zone.cc`
- **Comprehensive Directory Structure Cleanup**: Reorganized entire codebase for better maintainability and development workflow
- **CI/CD Workflow Updates**: Updated GitHub Actions workflows to work with new directory structure
  - **Linux Build Workflow**: Added directory structure verification and verbose makefile output
  - **Universal Installer Workflow**: Added directory verification step for installer builds
  - **Installer Script Compatibility**: Updated to handle both old and new asset locations
  - **Source Code Organization**: Moved scattered source files into logical `src/` structure:
    - `src/core/` - Core functionality (data management, configuration, logging, debugging)
    - `src/utils/` - Utility functions and helpers (string processing, font tracing, utilities)
    - `src/network/` - Network-related code (sockets, remote links, communication)
  - **Main Directory Categorization**: Organized main application modules by functionality:
    - `main/business/` - Business logic (sales, inventory, customers, employees, labor, tips, checks, accounts)
    - `main/hardware/` - Hardware interfaces (printers, terminals, CDU, drawers, remote printers)
    - `main/ui/` - User interface components (reports, charts, labels, system reports)
    - `main/data/` - Data management (settings, archives, system, locales, credit, expenses, manager)
  - **Scripts Organization**: Categorized scripts by purpose for better maintainability:
    - `scripts/build/` - Build and compilation scripts (vtbuild, vtclean, setbuildnum, vt-tag)
    - `scripts/install/` - Installation scripts and packages (installer, installs/, vtinst, vt_install)
    - `scripts/system/` - System management (restart, run, keeprunning, lpd-restart, vt_shutdown)
    - `scripts/maintenance/` - Backup, monitoring, maintenance tasks (backup, rotate, vt_ping)
    - `scripts/tools/` - Utility tools and development helpers (dat2txt, reportdebugs, vtcommands)
  - **Asset Organization**: Created proper asset management structure:
    - `assets/images/xpm/` - All XPM texture files organized by material type
    - `assets/data/po_file/` - Language translation files for internationalization
  - **Configuration Management**: Centralized configuration files:
    - `config/` - Version management, build configuration, and font definitions
  - **Documentation Structure**: Enhanced documentation organization:
    - `docs/development/` - Development documentation and workflows
    - `docs/user/` - User guides and system documentation
    - `docs/api/` - API documentation (ready for future expansion)
  - **Font Organization**: Organized fonts by family for better management:
    - `fonts/dejavu/` - DejaVu font family
    - `fonts/liberation/` - Liberation font family
    - `fonts/urw/` - URW font family
    - `fonts/nimbus/` - Nimbus font family
    - `fonts/ebgaramond/` - EB Garamond font family
  - **External Dependencies Cleanup**: Improved dependency management:
    - Removed duplicate `date-3.0.4` library
    - Organized SHA1 files into `external/core/` directory
    - Updated all CMake references for new structure
  - **Enhanced .gitignore**: Comprehensive exclusions for build artifacts, temporary files, and IDE files
  - **Build System Updates**: Updated all CMakeLists.txt paths to reflect new structure
  - **Benefits**:
    - **Professional Structure**: Follows modern C++ project organization standards
    - **Easier Navigation**: Developers can quickly find related files and functionality
    - **Better Maintainability**: Changes are easier to locate and implement
    - **Scalable Organization**: Structure supports future growth and expansion
    - **Clean Separation**: Clear boundaries between different system components
    - **Improved Development Experience**: Clear workflow and better code organization
- **Memory Safety Improvements**: Enhanced string handling and memory management throughout the codebase
  - Fixed unsafe `strcat()` operations in credit card test data generation (`term_view.cc`)
  - Replaced dangerous string concatenation with safe `std::string` operations and bounds checking
  - Added buffer overflow protection for credit card swipe buffer operations
  - Modernized C-style arrays to `std::array` for better type safety in `main/terminal.cc`
  - Replaced all `NULL` usage with `nullptr` for better type safety in `main/terminal.cc` and `zone/zone.cc`
  - Added missing `#include <array>` header for modern C++ array support
  - Improved parameter validation and error handling consistency
- **Dynamic Scaling System**: Implemented universal dynamic scaling for all display resolutions
  - Added comprehensive scaling system with 1920x1080 as universal reference resolution
  - Implemented `CalculateScaleFactors()`, `ScaleX()`, `ScaleY()`, `ScaleW()`, `ScaleH()`, and `ScaleFontSize()` functions
  - All UI elements now scale proportionally to fit any screen resolution (ultra-wide, 4K, portrait displays)
  - Universal page template system uses PAGE_SIZE_1920x1080 for all displays with dynamic scaling
  - Server always receives consistent 1920x1080 dimensions regardless of actual screen size
  - Removed hardcoded MAX_SCREEN_WIDTH and MAX_SCREEN_HEIGHT limits for better compatibility
  - Added X11 compatibility limits (4096x4096 max) for XServer XSDL and remote display support
  - Fonts, buttons, zones, and all UI elements scale smoothly across different resolutions
  - Maintains aspect ratios while utilizing full screen real estate on all display types

- **Tax Display in Order Entry**: Enhanced Order Entry button type to show tax information when adding items
  - Added `CalculateTax()` method to Order class for individual order tax calculation
  - Modified OrderEntryZone to display tax amount and total with tax in footer
  - Tax is shown as separate line item above total for transparency
  - Users can now see exact tax amount being added without sending order first
  - Quality of life improvement for better order visibility and customer service

### Fixed
- **Manager Table Transfer Regression**: Fixed an issue where managers or supervisors could not transfer guest checks to other employees
  - Clear the previous server's `user_current` flag during transfer so the new owner can immediately access the check
  - Reset table selection state and broadcast `UPDATE_CHECKS` to keep all terminals in sync after the reassignment
- **Vector Bounds Error**: Fixed crash when editing buttons due to vector bounds checking in dialog containers
  - Added proper bounds checking in `DialogMenu::Set()` and `DialogDoubleMenu::Set()` methods
  - Changed `CompareList()` unknown parameter from 0 to -1 for clearer invalid index detection
  - Prevents `std::vector::operator[]` assertion failures when accessing empty or undersized vectors
- **Thread Safety**: Improved thread safety in function tracing system
  - Fixed race conditions in atomic operations in `fntrace.cc`
  - Added proper bounds checking for stack depth to prevent overflow
- **Buffer Safety**: Replaced unsafe string functions with safer alternatives
  - Replaced `sprintf` with `snprintf` in `login_zone.cc` to prevent buffer overflows
  - Added proper buffer size checking for string operations

### Changed
- **CDU Utility Modernization**: Refactored `cdu_main.cc` to embrace RAII and safer parsing while preserving behavior
  - Added scoped wrappers for file descriptors and device locks to guarantee cleanup
  - Replaced global C-style state with `std::string` and strongly-typed device metadata
  - Improved command-line parsing with `std::from_chars` and whitespace-tolerant helpers
  - Retained legacy logging output while swapping to `std::printf`
- **Drawer Mode Terminology**: Changed "Normal" Drawer Mode to "Trusted" Drawer Mode for better clarity
- **Server Bank Payment Navigation**: Fixed Server Bank payment completion flow to return to Page -2 (PAGEID_LOGIN2) specifically for Customer users on SelfOrder terminals, while maintaining normal navigation for all other users
- **Modern C++ Refactoring**: Comprehensive modernization of C++ codebase for better performance, safety, and maintainability
  - **Smart Pointers**: Replaced raw pointers with `std::unique_ptr` for automatic memory management
  - **Modern Containers**: Replaced C-style arrays with `std::array` for type safety and better API
  - **Move Semantics**: Added move constructors and move assignment operators to `Layer` class for better performance
  - **Exception Safety**: Added `noexcept` specifications to functions that cannot throw exceptions
  - **Compile-time Optimization**: Added `constexpr` to simple functions and template functions
  - **Type Deduction**: Used `auto` keyword for cleaner and more maintainable code
  - **RAII Patterns**: Enhanced resource management with custom `FileDescriptor` wrapper and improved exception hierarchy
  - **Modern Casting**: Replaced C-style casts with `static_cast`, `const_cast`, and `reinterpret_cast`
  - **String Handling**: Improved string management with `std::string` and proper move semantics
  - **Optional Ownership**: Replaced raw pointer lookups in `LayerList`/`LayerObjectList` with `std::optional<std::reference_wrapper<...>>` helpers while keeping legacy APIs intact
  - **Dialog Menu Containers**: Eliminated manual `new[]/delete[]` for dialog menu widgets by using `std::vector`, defaulted move semantics, and blocked accidental copying
  - **Intrusive Lists**: Tightened `DList` semantics by deleting copy constructors/assignments and enabling move support to prevent misuse

### Added
- **QuickBooks CSV Export Feature**
  - **New Export Target**: Added `TARGET_QUICKBOOKS_CSV` target type and `MODEL_QUICKBOOKS_CSV` printer model for QuickBooks integration
  - **CSV Printer Implementation**: Created `PrinterQuickBooksCSV` class extending the base `Printer` class with specialized CSV formatting
    - `WriteCSVHeader()` method for CSV column headers (Date, Type, Account, Description, Amount, Tax)
    - `WriteCSVLine()` method for formatted CSV data rows with proper decimal formatting
    - File naming convention: `quickbooks_{YYYYMMDD}.csv` for daily exports
  - **Report Generation System**: Implemented `QuickBooksCSVExport()` method in System class
    - Aggregates sales data by category (food, alcohol, room, merchandise) using existing report functions
    - Processes payments by type (cash, credit card, checks, gift certificates, discounts, comps)
    - Handles tips, gratuity, and service charges with proper accounting categorization
    - Calculates and includes tax information for comprehensive financial reporting
  - **UI Integration**: Added QuickBooks export option to Admin panel under Reports
    - New `QuickBooksExport()` method in `ReportZone` class with case 37 signal handler
    - Users can access via Admin panel → Reports → "Export for QuickBooks (CSV)"
    - Supports daily, monthly, and custom date range exports
  - **Configuration Settings**: Added comprehensive QuickBooks export configuration
    - `quickbooks_export_path`: Configurable export directory (default: `/usr/viewtouch/exports/quickbooks`)
    - `quickbooks_auto_export`: Toggle for automatic daily export functionality
    - `quickbooks_export_format`: Export format selection (daily/monthly/custom)
    - Settings persist across sessions and integrate with existing settings system
  - **CSV Format Compatibility**: Optimized for QuickBooks Online and Desktop import
    - Standard CSV format with proper comma separation and decimal formatting
    - Financial transaction categorization (Income, Payment, Discount, Expense, Liability, Deposit)
    - Account mapping for common QuickBooks chart of accounts
    - Tax information included for accurate financial reporting
  - **Files Added**:
    - `zone/report_zone_quickbooks.cc` - UI implementation for QuickBooks export functionality
    - `QUICKBOOKS_EXPORT.md` - Comprehensive documentation and usage guide
  - **Files Modified**:
    - `main/printer.hh` - Added printer class declaration and target type definitions
    - `main/printer.cc` - Implemented QuickBooks CSV printer functionality
    - `main/system.hh` - Added export method declaration
    - `main/system_report.cc` - Implemented comprehensive export logic with data aggregation
    - `main/settings.hh` - Added configuration settings declarations
    - `main/settings.cc` - Implemented settings loading/saving with version compatibility
    - `zone/report_zone.hh` - Added UI method declaration
    - `zone/report_zone.cc` - Added signal handler for QuickBooks export
    - `CMakeLists.txt` - Updated build configuration for new source files
  - **Integration Benefits**:
    - Seamless integration with existing ViewTouch printer/export system
    - Uses established report aggregation functions for data consistency
    - Follows ViewTouch coding patterns and architecture
    - Maintains backward compatibility with existing functionality
    - Ready for production use with comprehensive error handling
- **SelfOrder Display Type (Work in Progress)**
  - **New Terminal Type**: Added `TERMINAL_SELFORDER` terminal type for customer self-service ordering
  - **Customer User System**: Implemented automatic "Customer" user creation and management for SelfOrder terminals
  - **Check Type Support**: Added `CHECK_SELFORDER` check type with proper identification methods
  - **Button Integration**: Added `quickselforder` button command and `selforder` expression keyword support
  - **Conditional Buttons**: SelfOrder terminals support conditional DineIn/TakeOut buttons with expressions
  - **No Login Required**: SelfOrder terminals bypass user authentication and automatically log in "Customer" user
  - **Job Security Configuration**: "Customer" user gets appropriate server job permissions for ordering
  - **Cancel Order Handling**: Implemented proper order cancellation that returns to SelfOrder main page
  - **Page Navigation**: SelfOrder terminals navigate to page -2 (customer page) for main interface
  - **Button Override Logic**: Cancel buttons skip default jump behavior to allow custom SelfOrder navigation
  - **Files Modified**:
    - `main/terminal.hh` - Added `TERMINAL_SELFORDER` enum and `NewSelfOrder()` method declaration
    - `main/check.hh` - Added `CHECK_SELFORDER` constant and `IsSelfOrder()` method declaration
    - `main/manager.cc` - Added SelfOrder to terminal type names and values arrays
    - `main/labels.cc` - Added SelfOrder to customer type names and values arrays
    - `main/terminal.cc` - Implemented SelfOrder terminal initialization, user management, and check creation
    - `main/check.cc` - Implemented `IsSelfOrder()` method for check type identification
    - `zone/button_zone.cc` - Added SelfOrder button command and expression support
    - `zone/order_zone.cc` - Added SelfOrder support to order flow and cancel handling
  - **⚠️ Work in Progress**: This feature is still under development and requires additional testing
    - Basic SelfOrder functionality implemented and working
    - Order creation, user management, and page navigation functional
    - Cancel order handling implemented with proper page navigation
    - Additional features and refinements may be added in future updates
- **Page Variant Configuration System**
  - **Hardware Configuration UI**: Added page variant selection (Page -1/Page -2) to terminal hardware configuration
  - **Terminal-Specific Page Defaults**: Each terminal can now be configured to default to either Page -1 or Page -2
  - **Backend Support**: Full backend implementation with data persistence and serialization
  - **Conditional Default Logic**: System respects individual terminal page variant settings for all fallback scenarios
  - **Page Mapping**: Correct mapping to ViewTouch page IDs (PAGEID_LOGIN = -1, PAGEID_LOGIN2 = -2)
  - **Comprehensive Integration**: Page variant setting affects startup, logout, error recovery, and page navigation
- **Comprehensive Data Persistence System**
  - **DataPersistenceManager Class**: Implemented robust data persistence and validation system to prevent data loss during long-running sessions
    - **Automatic Periodic Saving**: Auto-saves all critical data every 30 seconds (configurable)
    - **Data Integrity Validation**: Comprehensive validation before shutdown/restart to ensure all data is properly saved
    - **CUPS Communication Monitoring**: Automatic detection and recovery from CUPS printer communication failures
    - **Real-time Data Tracking**: Tracks dirty/clean state of all critical data components
    - **Emergency Save Procedures**: Handles critical failures with emergency data saving
    - **Comprehensive Logging**: Detailed logging of all save operations, errors, and warnings
    - **Backup Creation**: Automatic backup creation before shutdown with timestamped directories
    - **Thread-Safe Operations**: Full mutex protection for concurrent access
    - **Configurable Intervals**: Adjustable auto-save and CUPS monitoring intervals
  - **System Integration**: Fully integrated into ViewTouch core system

### Fixed
- **Hardware Settings Duplication Bug**: Fixed critical issue where printer and display settings were being duplicated in Hardware configuration
  - **Root Cause**: Hardware zone was automatically clearing `printer_host` when it matched `display_host`, creating a circular dependency
  - **Problematic Logic**: `StringCompare(ti->display_host.Value(), ti->printer_host.Value()) == 0` would clear `printer_host`
  - **Fallback Conflict**: Settings fallback logic would then set `printer_host` back to `display_host`, creating duplication
  - **User Impact**: Users couldn't configure independent display and printer hosts, settings appeared to "duplicate"
  - **Solution**: Removed automatic clearing logic, allowing independent configuration of display and printer settings
  - **Result**: Hardware button type now respects user choices without forced synchronization
- **Edit Mode Auto-Exit Bug**: Fixed issue where DataPersistenceManager was causing edit mode to auto-exit during periodic saves
  - **Smart Auto-Save Logic**: Auto-save now skips when terminals are in edit mode to avoid interrupting user workflow
  - **Edit Mode Detection**: Added `IsAnyTerminalInEditMode()` method to detect active edit sessions
  - **Preserved Shutdown Behavior**: Edit mode is still properly exited during system shutdown to ensure data is saved
  - **User Experience**: Users can now work in edit mode without being interrupted by periodic auto-save operations
    - **Startup Initialization**: DataPersistenceManager initialized during system startup
    - **Periodic Updates**: Integrated into main event loop for continuous monitoring
    - **Shutdown Preparation**: Enhanced shutdown process with comprehensive data validation
    - **Check Saving Hooks**: Real-time tracking of check data modifications
  - **Data Types Monitored**:
    - **Checks**: All open and closed checks with validation and error handling
    - **Settings**: System configuration and settings with integrity checks
    - **Archives**: Historical data archives with proper validation
    - **Terminals**: Terminal state and configuration monitoring
    - **CUPS Communication**: Printer communication health with automatic recovery
  - **Error Handling and Recovery**:
    - **Validation Results**: Success, Warning, Error, Critical levels
    - **Save Results**: Success, Partial, Failed, Critical Failure tracking
    - **CUPS Recovery**: Automatic CUPS service restart on communication failure
    - **Emergency Procedures**: Fallback mechanisms for critical system failures
  - **Benefits**:
    - **Data Loss Prevention**: Ensures all critical data is saved before shutdown
    - **CUPS Recovery**: Automatic detection and recovery from printer communication failures
    - **Proactive Monitoring**: Continuous monitoring of data integrity
    - **Detailed Logging**: Complete audit trail of all operations
    - **Emergency Procedures**: Robust handling of critical failures
    - **Configurable**: Flexible configuration for different environments
    - **Non-Intrusive**: Minimal impact on existing system performance
  - **Files Added**:
    - `data_persistence_manager.hh` - Header file with class definition
    - `data_persistence_manager.cc` - Implementation file with full functionality
    - `DATA_PERSISTENCE_SYSTEM.md` - Comprehensive documentation
  - **Files Modified**:
    - `CMakeLists.txt` - Added new source files to build system
    - `main/manager.cc` - Integrated persistence manager into system lifecycle
    - `main/check.cc` - Added data tracking hooks for check operations
    - `main/system.cc` - Enhanced error handling in check saving process
  - **⚠️ Field Testing Required**: This implementation requires comprehensive field testing to verify:
    - Long-running session stability (24+ hours)
    - CUPS communication failure recovery
    - Data integrity during unexpected shutdowns
    - Performance impact under high load
    - Backup and recovery procedures
    - Error handling under various failure scenarios
- **Universal Installer Icon Update**
  - Updated universal installer to use `Icon.png` instead of `demo.png` for desktop entry icon
  - The installer now properly displays the ViewTouch logo in applications menu and desktop environment
  - Enhanced visual branding consistency across the installation experience
- **Editor Order Entry Save Fix (Latest)**
  - **Fixed Editor Order Entry Changes Not Saving**: Resolved critical issue where editor changes to Order Entry button size/position were not being saved on program exit or Kill System
    - **Root Cause**: `EditTerm()` function only called `SaveSystemData()` for Super Users, not Editors
    - **Solution**: Modified `EditTerm()` to always call `SaveSystemData()` when exiting edit mode, regardless of user type
    - **Order Entry Changes**: Now properly saved to `vt_data` for both Super Users and Editors
    - **Kill System Integration**: Enhanced `EndSystem()` and `ExecuteRestart()` to call `EditTerm(1)` for all terminals before shutdown
    - **Data Persistence**: All Order Entry window changes (`oewindow[4]`) now persist across program restarts
    - **Comprehensive Coverage**: Fixes apply to F1 edit mode, F9 system edit mode, normal program exit, and Kill System button
- **Editor Settings Save Fix**
  - **Fixed "Editor Settings" Button Save Issue**: Resolved critical bug where Editor Settings button wasn't saving when using "save" + "Return To A Jump" sequence
    - Added proper save completion handling in `MessageButtonZone::SendandJump()`
    - Ensured settings are written to disk before jumping to prevent data loss
    - Added timing delays to guarantee file write completion
    - Enhanced save operation to include both Settings and System data persistence
    - Fixed race condition between save signal and page jump operations
- **High-Risk Crash and Freeze Prevention**
  - **SIGPIPE Handling Enhancement**: Implemented robust network reconnection system
    - Added `ReconnectToServer()` function for automatic socket reconnection (up to 20 attempts)
    - Added `RestartTerminal()` function for graceful terminal restart on connection loss
    - Replaced immediate `exit(1)` with intelligent reconnection logic in `SocketInputCB()`
    - Added proper error handling and user notifications for connection issues
    - Prevents application crashes when network connections are lost unexpectedly
  - **Buffer Overflow Vulnerabilities Fixed**: Enhanced memory safety in network operations
    - Fixed critical buffer overflow in `main/manager.cc` socket reading code
    - Added proper bounds checking with `sizeof(buffer) - 1` for safe string operations
    - Implemented null termination guarantees to prevent memory corruption
    - Enhanced security against potential buffer overflow attacks
  - **Double-Free Memory Errors Resolved**: Improved memory management and cleanup
    - Fixed double-free errors in `MasterControl` cleanup sequence in `main/manager.cc`
    - Implemented proper resource management for terminals and printers
    - Added safe cleanup sequence to prevent memory corruption
    - Enhanced memory safety and prevented crashes from improper cleanup
  - **I/O Timeout Protection**: Added timeout mechanisms to prevent application freezes
    - Implemented timeout-enabled connect functions in `socket.cc`
    - Added 10-second timeout for socket connections to prevent indefinite blocking
    - Enhanced error handling for timeout scenarios and connection failures
    - Prevents application freezes from unresponsive network operations
  - **Infinite Loop Prevention**: Added health checking and exit conditions
    - Enhanced `vt_ccq_pipe.cc` with proper health checking and error counters
    - Implemented graceful exit conditions for daemon processes
    - Added comprehensive error handling and logging for process monitoring
    - Prevented infinite loops that could cause system resource exhaustion
  - **Compilation and Build Improvements**: Fixed build system issues
    - Added missing system includes (`sys/socket.h`, `sys/un.h`) for proper compilation
    - Fixed declaration conflicts and unused variable warnings
    - Ensured clean compilation with zero errors and improved code quality
    - Enhanced maintainability and development workflow
  - **Null Pointer Protection**: Comprehensive null pointer dereference prevention
    - **Event Handler Protection**: Added null checks for all X11 event handlers
      - `TouchScreenCB`: Added null check for `TScreen` before accessing touch screen methods
      - `CalibrateCB`: Added null check for `TScreen` before calling `ReadStatus()`
      - `MouseClickCB`, `MouseReleaseCB`, `MouseMoveCB`: Added null checks for `event` parameter
      - `KeyPressCB`, `ExposeCB`: Added null checks for `event` parameter before processing
    - **System Management Protection**: Enhanced null pointer safety in critical system functions
      - `EndSystem()`: Added comprehensive null checks for all database pointers before calling `Save()`
      - `LoadSystemData()`: Added null checks for `MasterSystem` and `MasterControl` before accessing
      - `FindVTData()`: Added null check for `MasterSystem` before calling `FullPath()`
    - **Touch Screen Protection**: Enhanced null checking in touch screen operations
      - `UpdateCB()`: Added double null check for `TScreen` after `EndCalibrate()` call
      - `TouchScreenCB()`: Enhanced null checking with proper error logging
    - **Database Access Protection**: Secured all database save operations
      - Added null checks for `cc_exception_db`, `cc_refund_db`, `cc_void_db`
      - Added null checks for `cc_settle_results`, `cc_init_results`, `cc_saf_details_results`
      - Prevented crashes during system shutdown with corrupted data structures
- **Critical Crash Fixes and Stability Improvements**
  - **SIGPIPE Crash Resolution**: Fixed critical crash when ViewTouch loses connection to vtpos daemon
    - Added graceful handling of broken pipe errors in `CharQueue::Write()` method
    - Prevents application crash when server connection is lost unexpectedly
    - Returns -1 instead of crashing on `EPIPE` errors during socket writes
    - Handles connection loss scenarios gracefully without data corruption
  - **Employee Record Management Crashes**: Fixed multiple crash scenarios in employee management
    - **Null Pointer Protection**: Added comprehensive null checks in `UserEditZone::SaveRecord()`
      - Prevents crashes when no employee record is found during save operations
      - Added null checks for `FormField` objects during field iteration
      - Safe handling of empty or corrupted employee data structures
    - **Memory Allocation Safety**: Enhanced error handling in `UserDB::NewUser()`
      - Added null checks for `new Employee` and `new JobInfo` allocations
      - Proper cleanup and error logging when memory allocation fails
      - Prevents crashes from memory allocation failures
    - **Form Field Iteration Safety**: Fixed null pointer access during field processing
      - Added null checks before accessing `FormField` objects in loops
      - Prevents crashes when field list is shorter than expected
      - Safe iteration through employee form fields
  - **Expense Zone Crash Prevention**: Fixed null pointer access in expense management
    - Added null checks for `term->user` before accessing user properties
    - Prevents crashes when no user is logged in during expense operations
    - Safe handling of user authentication state in expense zones
  - **Enhanced Error Handling**: Improved overall application stability
    - Replaced unsafe string functions (`sprintf`, `strcat`) with `snprintf` for buffer safety
    - Added exception handling around `std::stoi` calls for string-to-integer conversion
    - Improved array bounds checking in database operations
    - Better error logging and graceful degradation on failures
- **Fixed Printer Connectivity and Status Issues**
  - **Enhanced Printer Status Detection**: Improved printer connection monitoring with detailed error reporting
    - Progressive status updates at connection failure attempts 1, 4, and 8
    - Proper offline status tracking using `failure = 999` flag without killing printer objects
    - Automatic detection and reporting of connection restoration
  - **Automatic Printer Reconnection**: Added robust reconnection logic for network printers
    - New `Reconnect()` method in `RemotePrinter` class for automatic reconnection attempts
    - Proper socket recreation and `vt_print` daemon restart when needed
    - Callback re-registration after successful reconnection
    - Reconnection attempts every 30 seconds for offline printers
  - **Printer Health Monitoring**: Added periodic health checks in main system update loop
    - Monitors all printers every 30 seconds for connectivity issues
    - Detailed logging of printer status and connection health
    - Debug mode support for enhanced monitoring information
  - **Accurate Online Status Checking**: New `IsOnline()` method for reliable printer status determination
    - Multi-factor detection checking socket status, failure count, and offline flags
    - UI integration ready for accurate printer status display
    - Eliminates false "OK" status when printers are actually offline
  - **Improved Error Handling**: Better error messages and graceful handling of printer disconnections
    - System continues working even when some printers are offline
    - No more abrupt printer removal on connection failures
    - Enhanced logging for troubleshooting printer connectivity issues
- **Complete Kitchen and Bar Video Display Separation with Order Recall**
  - **Independent Status Tracking**: Implemented separate check flags for kitchen and bar video displays
    - `CF_KITCHEN_MADE` (16): Kitchen marks their portion as made/ready
    - `CF_BAR_MADE` (32): Bar marks their portion as made/ready  
    - `CF_KITCHEN_SERVED` (64): Kitchen marks their portion as served
    - `CF_BAR_SERVED` (128): Bar marks their portion as served
  - **Three-Tap Workflow**: Complete order lifecycle management for each video target
    - **First Tap**: Marks order as "made" for that video target only
    - **Second Tap**: Marks order as "served" for that video target only  
    - **Third Tap**: Recalls the order back to the video display for that target only
  - **Enhanced Undo Button**: Provides granular control to recall served orders
    - Finds most recent check served by current video target
    - Recalls order by clearing target-specific served flag
    - Only affects current video target, not others
    - Brings order back to video display for verification
  - **Complete Video Target Coverage**: Supports all kitchen and bar video displays
    - Kitchen 1, Kitchen 2, Bar 1, Bar 2 all work independently
    - Each target maintains separate order status tracking
    - No cross-interference between any video targets
  - **Complete Workflow Independence**: Kitchen and bar can work without interfering with each other
  - **No Cross-Interference**: Actions on one video target never affect the other
  - Enhanced `ToggleCheckReport` method to use target-specific flags for both highlighting and serving
  - Updated `DisplayCheckReport` method to check appropriate flags for each video target
  - Modified `UndoRecentCheck` method to provide target-specific order recall
  - Comprehensive documentation in `VIEWTOUCH_IMPROVEMENTS_SUMMARY.md`

- **Fixed Video Target Routing System**
  - **Corrected Array Indexing**: Fixed `Order::VideoTarget()` method to use direct family ID indexing
  - **Proper Item Routing**: Items now route to correct video displays based on their family settings
  - **Family-Based Targeting**: Food items (burgers, appetizers) go to kitchen video, drinks (cocktails, wine) go to bar video
  - **Eliminated Misrouting**: No more items appearing on wrong video displays regardless of family settings

- **Enhanced Settings Persistence and Loading**
  - **Fixed Video Target Loading**: Corrected array indexing in `VideoTargetZone` and `PrintTargetZone`
  - **Settings Persistence**: Video and printer target settings by family now properly save and load
  - **Improved Default Values**: Changed from problematic `PRINTER_NONE` to sensible `PRINTER_DEFAULT`
  - **Version Compatibility**: Enhanced loading logic for older settings files (version < 34)
  - **Fixed Manager Settings Save**: Prevented premature settings save that could overwrite loaded values
  - **Automatic Synchronization**: Video and printer targets automatically stay synchronized

- **Enhanced Texture System with New Materials**
  - **Carbon Fiber Texture**: Added high-quality carbon fiber material (128x128, 6 colors)
  - **Color Textures**: Added 6 new color-based textures (128x128, 32 colors each):
    - White Texture, Dark Orange Texture, Yellow Texture, Green Texture, Orange Texture, Blue Texture
  - **High-Detail Textures**: Added 6 new detailed materials (256x256, 64 colors each):
    - Pool Table, Test Pattern, Diamond Leather, Bread, Lava, Dark Marble
  - **Unified Resolution**: Standardized all new textures to optimal 256x256 resolution for consistency
  - **Performance Optimized**: Reduced file sizes from ~1.5MB to ~45KB while maintaining visual quality
  - **Full Integration**: All textures properly integrated into ViewTouch enum system, image data arrays, and UI labels
  - **Build System**: Successfully integrated into CMake build system with no compilation errors

- **F3/F4 Recording Control Feature**
  - Added user-configurable control over F3/F4 recording and replay functionality
  - New setting `enable_f3_f4_recording` in Soft Switches page
  - Default disabled (0) for safety in production environments
  - Requires only the Soft Switch to be enabled (no debug mode required)
  - Prevents accidental triggering of long replay sequences
  - Integrated with existing Soft Switches system for consistent user experience
  - Comprehensive documentation in `F3_F4_RECORDING_CONTROL.md`

### Code Modernization
- **Upgraded to C++20 Standard**
  - Enhanced build system to use C++20 features and modern compiler capabilities
  - Enabled additional compiler warnings: `-Wextra`, `-Wconversion`, `-Wnull-dereference`, `-Wdouble-promotion`, `-Wformat=2`
  - Improved code safety and error detection during compilation

- **Core Utility Functions Refactoring (debug.cc, debug.hh, socket.cc, socket.hh, utility.cc, utility.hh, manager.cc, manager.hh)**
  - **Memory Safety Enhancements**: Replaced C-style arrays with `std::array` for compile-time bounds checking
    - `debug.cc`: Converted `event_names`, `term_codes`, and `server_codes` arrays to `constexpr std::array`
    - Enhanced buffer operations with proper null termination guarantees
    - Added comprehensive parameter validation for all functions
    - `manager.cc`: Fixed critical buffer overflow vulnerabilities in main command reading loop
    - `manager.cc`: Enhanced `GetMachineName()` with proper bounds checking and null termination
    - `manager.cc`: Improved `PriceFormat()` with modern C++ string handling and `std::array`
    - `manager.cc`: Fixed `ParsePrice()` with modern C++ string handling and error checking
    - `manager.cc`: Enhanced `ViewTouchError()` with parameter validation and safer string operations
    - `manager.cc`: Improved `Control` class methods with comprehensive input validation
  - **Modern C++ Features**: Applied C++17/20 features throughout the codebase
    - Replaced `NULL` with `nullptr` for better type safety
    - Used `auto` for type deduction and `constexpr` for compile-time constants
    - Added `noexcept` specifiers where appropriate for better performance
    - Implemented pre-increment operators (`++idx`) for better performance
  - **String Operations Safety**: Enhanced string handling with bounds checking
    - Replaced `sprintf` with `snprintf` for safe string formatting
    - Added null termination guarantees for all string operations
    - Improved buffer overflow protection in socket and utility functions
  - **Error Handling Improvements**: Added comprehensive error handling and validation
    - Enhanced input validation for all socket operations (port ranges, file descriptors)
    - Added exception handling for string conversion operations (`std::stoi`, `std::stod`)
    - Improved bounds checking for array and buffer operations
  - **Const Correctness**: Enhanced const correctness throughout the codebase
    - Added `const` qualifiers to appropriate methods and parameters
    - Improved function signatures for better API design
    - Enhanced type safety with explicit parameter validation
  - **Code Quality Improvements**: Modernized code patterns and eliminated legacy issues
    - Fixed unused parameter warnings with proper parameter naming
    - Enhanced loop constructs with modern C++ patterns
    - Improved code readability and maintainability
  - **Files Modified**:
    - `debug.cc` - Modernized debug functions with std::array and enhanced error handling
    - `debug.hh` - Added noexcept specifiers and improved function declarations
    - `socket.cc` - Enhanced socket operations with parameter validation and modern C++ features
    - `socket.hh` - Improved const correctness and function signatures
    - `utility.cc` - Modernized utility functions with bounds checking and exception handling
    - `utility.hh` - Enhanced const correctness and added noexcept specifiers
    - `manager.cc` - Fixed critical buffer overflow vulnerabilities and enhanced error handling
    - `manager.hh` - Improved const correctness and added noexcept specifiers
    - `system_report.cc` - Fixed royalty report infinite loop and day attribution issues, modernized with C++17/20 features
  - **Benefits**:
    - **Memory Safety**: Eliminated potential buffer overflows and null pointer dereferences
    - **Robustness**: Enhanced error handling and input validation
    - **Performance**: Better compiler optimizations with constexpr and noexcept
    - **Maintainability**: Cleaner, more modern C++ code with better structure
    - **Compatibility**: All changes maintain existing API and behavior

- **Fixed Royalty Report Critical Issues (system_report.cc)**
  - **Infinite Loop Fix**: Fixed royalty report getting stuck on "working..." when no checks to process
    - Added proper null check for `currCheck` to prevent infinite cycling
    - Fixed work function to properly exit when no data available
    - Fixed syntax error with missing braces in conditional logic
  - **Day Attribution Fix**: Fixed sales data being attributed to wrong days
    - Changed day index calculation from check opening time to settlement time
    - Ensures cross-day transactions are properly attributed to settlement day
    - Fixed daily sales totals accuracy in royalty calculations
  - **Impact**: Royalty reports now complete successfully and show accurate daily sales data

- **Modernized System Report Generation (system_report.cc)**
  - **Memory Safety Improvements**: Replaced all `sprintf` calls with `snprintf` for buffer safety
    - Added proper bounds checking to prevent buffer overflows
    - Enhanced string formatting with size validation
  - **Modern C++ Features**: Replaced `NULL` with `nullptr` throughout the codebase
    - Improved type safety and null pointer handling
    - Better compiler optimization opportunities
  - **Array Initialization Optimization**: Modernized C-style loops with `std::fill`
    - Replaced manual loops with STL algorithms for array initialization
    - More efficient and readable code for large array operations
    - Added `#include <algorithm>` for STL support
  - **Enhanced Parameter Validation**: Added null pointer checks to critical functions
    - `System::ServerReport()` now validates both `term` and `ptrReport` parameters
    - `System::ShiftBalanceReport()` includes comprehensive parameter validation
    - Improved error handling and early return patterns
  - **String Handling Improvements**: Enhanced C-style string operations
    - Replaced `strcpy` with `snprintf` for safer string copying
    - Added proper buffer size validation in string operations
    - Maintained backward compatibility while improving safety
  - **Code Quality**: Improved overall code structure and maintainability
    - More consistent error handling patterns
    - Better separation of concerns in large functions
    - Enhanced readability and maintainability

- **Modernized vt_print Daemon (print_main.cc)**
  - **Critical Bug Fix**: Removed debug `exit(2)` statement that prevented the program from running
  - **Modern C++ Improvements**: Updated includes from C-style to C++ headers (`<cstring>`, `<csignal>`, `<vector>`)
  - **Enhanced Buffer Management**: Replaced raw `char buffer[STRLENGTH]` with `std::vector<char>` for automatic memory management
  - **Graceful Shutdown**: Added signal handlers for SIGINT/SIGTERM with proper cleanup and resource management
  - **Improved Error Handling**: Enhanced error reporting with proper validation and resource cleanup
  - **Const Correctness**: Improved parameter passing with `const char* const argv[]` and better variable initialization
  - **Input Validation**: Added port number range checking (1-65535) and better argument parsing
  - **Resource Safety**: Proper file descriptor management and cleanup on exit to prevent resource leaks
  - **Better Data Flow**: Enhanced handling of partial writes, connection states, and shutdown scenarios
  - All improvements maintain full backward compatibility with existing functionality

- **Memory Safety Improvements**
  - **RemotePrinter Class**: Converted from raw `new`/`delete` to `std::unique_ptr` and `std::make_unique`
  - **System Class**: Modernized all credit card database pointers to use `std::unique_ptr`
  - **CharQueue Class**: Replaced raw arrays with `std::vector` for automatic memory management
  - Eliminated manual memory cleanup in destructors - smart pointers handle this automatically
  - Removed 280+ instances of unsafe raw pointer usage

- **String Safety and Modern STL Usage**
  - Replaced all `sprintf` calls with `snprintf` using proper bounds checking
  - Converted C-style arrays to `std::array` and `std::vector` throughout codebase
  - **MediaList Class**: Modernized to use `std::string` instead of raw character arrays
  - Enhanced string handling with proper size validation and bounds checking
  - Replaced 50+ unsafe string functions with safe alternatives

- **New Infrastructure and Utilities**
  - **`string_utils.hh/cc`**: Comprehensive modern string processing utilities
    - Unicode-aware string operations with UTF-8 support
    - Safe string formatting, case conversion, and validation
    - File path manipulation and sanitization functions
    - Template-based type-safe formatting system
  - **`error_handler.hh/cc`**: Unified error handling framework
    - Centralized error reporting with severity levels and categories
    - Thread-safe error logging with configurable output destinations
    - Error callback system for custom error handling
    - Comprehensive error history and filtering capabilities

- **Performance and Safety Enhancements**
  - Added `const` references to function parameters to improve performance
  - Enhanced null pointer safety with smart pointer usage
  - Improved type safety with modern C++ features
  - Better bounds checking and array access validation
  - Optimized memory usage patterns throughout the codebase

- **Build System Modernization**
  - Integrated new utility modules into CMake build system
  - Enhanced dependency management for new components
  - Improved compiler warning coverage for better code quality
  - **Fixed CMake installation directory creation**: Added proper directory structure creation for all installation paths (`/usr/viewtouch/bin`, `/usr/viewtouch/lib`, `/usr/share/viewtouch/fonts`, etc.) to prevent installation failures

- **UI and Visual Enhancements**
  - **Improved text shadow colors**: Fixed harsh pure black shadows for white, yellow, and gray text colors to provide better readability and visual appeal
    - White text: Changed from pure black `{0,0,0}` to medium gray `{64,64,64}` shadows
    - Yellow text: Changed from pure black `{0,0,0}` to warm dark olive `{96,64,0}` shadows  
    - Gray text: Changed from pure black `{0,0,0}` to dark gray `{32,32,32}` shadows
  - **F3/F4 Recording Button UI Improvements**: Enhanced the F3/F4 Recording button in Settings to match the professional appearance of other settings buttons
    - Changed button text from verbose "Enable F3/F4 Recording/Replay" to clean "F3/F4" for better fit
    - Implemented proper On/Off status display at bottom (red "Off", green "On") matching Seat Based Ordering button style
    - Fixed button toggle functionality to properly switch between OFF and ON states
    - Removed debug text and improved text positioning to prevent overlap
    - Enhanced user experience with immediate visual feedback and consistent styling
  - Enhanced consistency with frost and embossed text effects
  - All changes maintain full backward compatibility with existing functionality

### Added
- **Scheduled Restart Feature with User Prompts**
  - Added configurable scheduled restart functionality to System Variables
  - Users can set restart time (hour and minute) with -1 to disable
  - Smart user prompt system appears at scheduled restart time with options:
    - "Restart Now" for immediate graceful restart
    - "Postpone 1 Hour" to delay restart by exactly 60 minutes
    - Auto-restart after 5 minutes if no user response (safety mechanism)
  - Daily reset of postpone counters at midnight
  - Complete state persistence across ViewTouch sessions
  - Tracks postponement count for monitoring purposes
  - Integrated with existing settings system and UI workflow
- **Automatic vt_data Download on Startup**
  - ViewTouch now automatically downloads latest vt_data from update servers on startup
  - Dual URL support with automatic fallback:
    - Primary: `http://www.viewtouch.com/vt_data`
    - Fallback: `https://www.viewtouch.com/vt_data`
  - Smart offline handling: Only downloads when local vt_data is missing
  - **Enhanced Safety**: Downloads to temporary files first, only replaces original on success
  - **Automatic Backup Cleanup**: Removes old .bak and .bak2 files after successful updates
  - **Offline Resilience**: System starts normally with existing vt_data when offline
  - Comprehensive error handling and logging for troubleshooting
  - Uses existing robust download infrastructure with timeout handling
- **Comprehensive Text Enhancement System**
  - Implemented system-wide enhanced text rendering with three configurable effects
  - **Embossed Text Effect**: Creates 3D frosted glass appearance with highlights and shadows (disabled by default; enable in Settings)
  - **Anti-aliasing**: Smooths text edges for improved readability across all font sizes
  - **Drop Shadows**: Configurable shadow effects for better text contrast and depth
  - Complete coverage across all ViewTouch UI elements including:
    - Main terminal interface (buttons, menus, dialogs, forms)
    - Zone text rendering (names, labels, content, prices)
    - Status bars and information displays
    - Dialog and form text (titles, labels, messages)
    - All specialized zones (TableZone, OrderZone, PaymentZone, etc.)
    - All font families (Times, Courier, DejaVu, EB Garamond, etc.)
  - Configurable settings with UI controls for all effects
  - Performance-optimized rendering with minimal overhead
  - Graceful fallback to standard rendering when enhanced features unavailable
  - Comprehensive documentation in `TEXT_ENHANCEMENT_FEATURES.md`
  - All text elements now use enhanced rendering for consistent, professional appearance
- **Unified Video and Printer Targeting System**
  - Modified existing VideoTargetZone and PrintTargetZone to automatically synchronize both video and printer targets
  - When either zone is used, both `video_target` and `family_printer` arrays are updated simultaneously
  - Updated zone titles to "Video & Printer Targets by Family" for clarity
  - Ensures "Video Targets must match Printer Targets" requirement is always met
  - No changes required to existing page configurations - backward compatible
  - Eliminates the need for separate configuration of video and printer targets
- **Catch2 v3.8.1 Integration**
  - Successfully integrated Catch2 v3.8.1 as a modern, header-only testing framework
  - Added proper CMake configuration with build options for testing control
  - Configured test infrastructure with `Catch2::Catch2WithMain` target linking
  - Verified integration with comprehensive test suite (13 assertions, 3 test cases)
  - Confirmed C++17/20 compatibility including structured bindings and std::optional
  - Created detailed integration documentation in `CATCH2_INTEGRATION.md`
  - Maintained clean workspace by removing temporary test files after verification
  - Ready for production testing when needed with simple test file creation process
- Complete Greek (EL) and Spanish (ES) localization for ViewTouch POS system
  - Added comprehensive translation files: `po_file/viewtouch.po_EL` and `po_file/viewtouch.po_ES`
  - Translated all user-facing UI strings, system messages, error messages, and report titles
  - Translated payment and receipt terms, order and table management, labor and time clock functionality
  - Translated system configuration labels, credit card types, transaction types, and sales categories
  - Translated dialog messages, form field labels, and status notifications
  - Maintained proper nouns, brand names, and technical codes untranslated as appropriate
  - Both languages now provide complete localization coverage for the ViewTouch POS interface
- Enhanced "Move Guest Check to Another Table" functionality to support merging tables with existing checks
  - When moving a check to a table that already has a check, users are now prompted to merge the tables
  - Merging combines all orders from both checks into a single check at the target table
  - Guest counts are automatically combined when merging tables
  - Provides confirmation dialog to prevent accidental merges
- Improved download functionality for vt_data, menu.dat, table.dat, and zone_db.dat files
  - Added support for both HTTPS and HTTP protocols with automatic fallback
  - Enhanced error handling and file verification for reliable downloads
  - Improved compatibility with Raspberry Pi and other systems with SSL/TLS issues
  - Added proper timeout and connection settings for network requests
  - Implemented file size verification to ensure complete downloads
- Fixed "Suppress Zero Values" functionality in Accountant's Report: Receipt & Cash Deposit
  - Zero values are now properly suppressed when the setting is enabled
  - Report automatically refreshes when the setting is toggled for immediate visual feedback
  - Applied to all relevant sections: tax types, non-cash receipts, adjustments, and payment methods
- Migrated from Catch2 v2.13.10 to Catch2 v3.8.1
  - Updated from single-header approach to library-based architecture
  - Improved compile times by only including necessary headers
  - Added comprehensive test infrastructure with basic and feature demonstration tests
  - Enhanced testing capabilities with improved matchers, generators, and reporting
  - Created detailed migration documentation in CATCH2_V3_MIGRATION.md
- **NEW: Full Catch2 v3 Integration and Test Suite**
  - Integrated Catch2 v3.8.1 as external dependency with proper CMake configuration
  - Created comprehensive test suite structure with `tests/` directory
  - Added test modules for `conf_file`, `time_info`, and `utility` components
  - Implemented basic Catch2 integration tests to verify framework functionality
  - Created custom `test_all` target for running all tests with CTest integration
  - Updated GitHub Actions workflow to test Catch2 integration across multiple compilers
  - All tests pass successfully on GCC 12-14 and Clang 16-18 with C++17/C++20 standards
  - Test infrastructure ready for future ViewTouch-specific unit tests

- **Editor Access to Order Entry Button Customization with Persistent Storage**
  - **Extended Editor Permissions**: Editor users (id == 2) can now edit the size and position of the Order Entry Button
    - Modified `PosZone::CanEdit()` and `PosZone::CanCopy()` to allow Editor access to `ZONE_ORDER_ENTRY` zones
    - Editors can now customize the Order Entry Button size and position like Superusers
    - Maintains security by restricting access only to the Order Entry Button, not other system zones
  - **Persistent Custom Size Storage**: Order Entry Button size changes are now automatically saved to `vt_data`
    - Added `SaveSystemData()` calls in `OrderEntryZone::SetSize()` and `OrderEntryZone::SetPosition()` methods
    - Custom sizes persist across program restarts and are stored in the system data file
    - Changes are immediately written to `vt_data` when made by any authorized user
  - **Auto-Update Control with Visual Feedback**: Added user-configurable control over automatic `vt_data` updates
    - New soft switch "Auto-Update vt_data on Startup" with clear ON/OFF visual feedback
    - Green "ON" and Red "OFF" status display matching other soft switch buttons
    - When disabled, prevents automatic `vt_data` downloads that would overwrite custom settings
    - Integrated with existing Soft Switches system for consistent user experience
    - Default enabled for backward compatibility, but users can disable to preserve customizations
  - **Complete Workflow**: Editors can now customize Order Entry Button size, save changes permanently, and control when system updates occur

- **Editor Access to Tender Button Configuration (Surcharge and Gratuity)**
  - **Extended Editor Permissions**: Editor users (id == 2) can now configure the percentage and amount for Surcharge buttons and Gratuity buttons
    - Modified `PosZone::CanSelect()`, `PosZone::CanEdit()`, and `PosZone::CanCopy()` to allow Editor access to `ZONE_TENDER` zones on system pages
    - Updated `Terminal::EditZone()` to grant Editors `full_edit` access when editing tender zones
    - Editors can now set the percentage and amount for:
      - Surcharge buttons: `TENDER_CREDIT_CARD_FEE_DOLLAR` (fixed dollar amount) and `TENDER_CREDIT_CARD_FEE_PERCENT` (percentage-based)
      - Gratuity button: `TENDER_GRATUITY` (percentage-based)
    - Maintains security by restricting access only to tender zones, not other system zones
  - **Complete Workflow**: Editors can now select tender buttons, open the zone editor dialog, and modify both the Tender Type and Tender Amount fields
  - Files modified: `zone/pos_zone.cc`, `main/hardware/terminal.cc`

- **Enhanced RUNCMD: Terminal Command Execution**
  - **Expanded Command Support**: Enhanced the existing RUNCMD: functionality in Standard buttons to support more shell command characters
    - Now supports colons (`:`), dollar signs (`$`), pipes (`|`), ampersands (`&`), redirection (`>`, `<`), and other common shell operators
    - Allows complex shell commands like `RUNCMD:sudo /usr/viewtouch/bin/pull.sh` to execute properly
    - Maintains security by still validating commands while being more permissive for legitimate shell operations
  - **Improved Command Validation**: Updated `ValidateCommand` function to allow essential shell command characters
    - Supports command substitution, pipes, redirection, and other shell features
    - Prevents execution of commands starting with dots (`.`) for security
    - Maintains protection against potentially dangerous command patterns
  - **Seamless Integration**: Works with existing Standard button Message section without requiring new button types
    - Commands execute using `system()` and output is logged to `/usr/viewtouch/dat/text/command.log`
    - No changes required to existing button configurations - backward compatible
    - Users can now run complex terminal commands directly from ViewTouch interface

### Changed
- **Improved Embossed Text Rendering for Better Readability**
  - Enhanced embossed text frosting effects to use proportional brightness adjustments
  - Replaced color-distorting red tinting with balanced luminance-based highlighting
  - Shadow effects now use 60% intensity while highlights use 40% brightness boost
  - Maintains original color hue and saturation for improved readability
  - Applied consistently across all embossed text rendering (main interface, loader, font checker)
- Font selection now updates all zones and all toolbar/dialog buttons for consistent UI appearance
- Font compatibility is enforced: only fonts with compatible metrics are available for selection, preventing UI breakage
- Font size and weight selection logic improved and consolidated for reliability

### Removed
- remove GTK+3 dependency, only used in loader, where we revert to use X11 directly #127

### Fixed
- **Printer Duplication Bug**: Fixed critical issue where printers were being duplicated after ViewTouch restart
  - **Root Cause**: System was creating new "Report Printer" entries on every startup without checking if one already existed
  - **Problem**: Each restart would add another report printer to settings, causing multiple duplicate entries
  - **Solution**: Added duplicate check using `settings->FindPrinterByType(PRINTER_REPORT)` before creating new report printers
  - **Implementation**: Modified report printer creation logic in `StartSystem()` function to reuse existing printers
  - **Result**: Only one report printer is created and maintained across multiple restarts
  - **Files Modified**: `main/data/manager.cc` - Enhanced printer initialization with duplicate prevention
  - **Impact**: Eliminates printer duplication in settings, maintains clean configuration files
- **Version Number and Date Update**: Updated version number to reflect current year and fixed version date display in Page 1 lower left corner
  - **Version Number**: Updated from "21.05.1" to "25.01.1" to reflect current year 2025
  - **Version Date**: Fixed version date display to show current build date (2025-09-18) instead of cached 2021 date
  - **Root Cause**: Version timestamp was correctly generated but cached version_generated.hh file contained old date
  - **Solution**: Updated version.cmake with new major/minor version numbers and regenerated version files with `make clean` and `make`
  - **Result**: Version display now correctly shows "POS 25.01.1-74 2025-09-18" with current year and build date
- **SelfOrder Mode Differentiation**: Added support for SelfDineIn and SelfTakeOut check types in SelfOrder mode
  - **New Check Types**: Added `CHECK_SELFDINEIN` (11) and `CHECK_SELFTAKEOUT` (12) to distinguish between dine-in and take-out orders
  - **Enhanced Methods**: Added `IsSelfDineIn()` and `IsSelfTakeOut()` methods to Check class for proper type identification
  - **Updated Logic**: Modified `IsSelfOrder()`, `IsTakeOut()`, and `IsForHere()` methods to include new SelfOrder variants
  - **Terminal Support**: Updated `QuickMode()` method to handle new SelfOrder check types with proper validation
  - **Files Modified**: `main/check.hh`, `main/check.cc`, `main/terminal.cc`
- **SelfOrder Drawer Access Issue**: Fixed "No Drawer Available" message when drawer is configured for SelfOrder terminals
  - **Root Cause**: Customer user (ID 999) created for SelfOrder terminals lacked `SECURITY_SETTLE` permission needed for drawer access
  - **Solution**: Updated Customer user setup to include `SECURITY_SETTLE` permission in addition to existing `SECURITY_TABLES` and `SECURITY_ORDER`
  - **Implementation**: Modified all three Customer user creation locations in `main/terminal.cc` to grant proper permissions
  - **Result**: SelfOrder terminals can now properly access drawers for payment processing without errors
- **Check Type Constants Backward Compatibility**: Fixed data corruption issue caused by renumbering existing check type constants
  - **Problem**: Renumbering `CHECK_DINEIN`, `CHECK_TOGO`, and `CHECK_CALLIN` from values 11-13 to 13-15 broke backward compatibility
  - **Impact**: Saved checks with old type values (11 for `CHECK_DINEIN`) were misinterpreted as new types like `CHECK_SELFDINEIN`, causing incorrect behavior and data corruption
  - **Solution**: Restored original values for existing constants and reassigned new values to `CHECK_SELFDINEIN` and `CHECK_SELFTAKEOUT`
  - **New Values**: `CHECK_DINEIN`=11, `CHECK_TOGO`=12, `CHECK_CALLIN`=13, `CHECK_SELFDINEIN`=14, `CHECK_SELFTAKEOUT`=15
  - **Result**: Existing saved checks with old type values now work correctly without data corruption
- **IsToGo() Method Consistency**: Fixed inconsistency in `IsToGo()` method to include `CHECK_SELFTAKEOUT`
  - **Problem**: `IsToGo()` method didn't account for `CHECK_SELFTAKEOUT`, creating inconsistency with other related methods
  - **Impact**: Self-service takeout orders (`CHECK_SELFTAKEOUT`) were not properly identified as "to go" orders
  - **Solution**: Updated `IsToGo()` method to include `CHECK_SELFTAKEOUT` check type
  - **Consistency**: Now matches pattern used in `IsTakeOut()` and `IsForHere()` methods which include their corresponding self-service types
  - **Result**: Self-service takeout orders are now correctly identified as "to go" orders
- Allow settlement after reset for users with Settle permission
  - Removed terminal-type restriction in `Terminal::CanSettleCheck()` that blocked settling on `ORDER_ONLY` terminals after reset
  - Settlement still requires a valid drawer and respects ownership/supervisor checks
- fix configure step by searching for `PkgConfig` before using `pkg_check_module` #128
- update embedded `catch.hpp` to `v2.13.10` to fix compilation on Ubuntu 20.04 and newer #131
- Fixed: Changing font now updates all UI elements, including toolbar and dialog buttons, not just some zones
- Fixed: UI no longer breaks or crashes when switching to scalable fonts; only compatible fonts are shown
- Fixed: Font size and weight selection no longer causes crashes or mismatches
- Fixed: Catch2 v3 migration completed successfully with all tests passing
- Fixed: "Receipts Balance & Cash Deposit" report no longer causes infinite loading cursor on clean installations
  - Added early exit in `BalanceReportWorkFn` when no checks exist to process
  - Prevents work function from being rescheduled indefinitely when database is empty
  - Report now completes immediately and shows appropriate empty state
- **Fixed: "Refresh ViewTouch" Hanging Issue**
  - **Root Cause**: Segmentation fault in `XtRemoveInput()` during X11 resource cleanup
  - **Problem**: ViewTouch would hang on "Shutting Down" when trying to remove X11 input handlers with invalid context
  - **Solution**: Added proper validation and error handling for all `XtRemoveInput()` calls
    - Added `App != NULL` check in `RemoveInputFn()` before calling `XtRemoveInput()`
    - Wrapped `XtRemoveInput()` calls in try-catch blocks in `term_view.cc`
    - Added error logging for invalid Xt context scenarios
    - Ensured input IDs are properly reset to 0 after removal
  - **Files Modified**:
    - `main/manager.cc` - Enhanced `RemoveInputFn()` with context validation
    - `term/term_view.cc` - Added exception handling in `SocketInputCB()`, `StopTouches()`, and cleanup functions
  - **Result**: "Refresh ViewTouch" button now works correctly without hanging
  - **Impact**: System restart (`sudo shutdown -r now`) also works properly from within ViewTouch
  - **Testing**: Verified restart functionality with signal testing - old process terminates cleanly, new process starts successfully


## [v21.05.1] - 2021-05-18
### Added
- download bootstrap files if missing #119
  - `viewouch/bin/vt_data`     from http://www.viewtouch.com/vt_data
  - `viewouch/dat/tables.dat`  from http://www.viewtouch.com/tables.dat
  - `viewouch/dat/menu.dat`    from http://www.viewtouch.com/menu.dat
  - `viewouch/dat/zone_db.dat` from http://www.viewtouch.com/zone_db.dat
  - download functionality require a package providing `libcurl-dev`, for example `libcurl4-gntuls-dev` on Debian/Ubuntu
- create `viewtouch/dat/conf` directory if missing #119
- create `viewtouch/dat/screensaver` directory if missing #119
- require at least gcc-8 and C++17 for `std::filesystem` support #119

### Changed
- update external copy of Catch2 to v2.13.4

### Fixed
- fix double line after header in some report tables #115
- fix Segfault in Page 13 of 16 in "Customize Job Title, Families, Phrases" #117


## [v21.01.1] - 2021-01-06
### Fixed
- fix "Users have to once again Clock In when ViewTouch exits and is restarted" #108
- fix "Timeclock" page by handling non-set start TimeInfo


## [v19.05.1] - 2019-05-26
### Changed
- update embedded date library

### Fixed
- fix "Clear Highlighted Entries" button in payment zone
- fix build on FreeBSD (error in `license_hash.cc`)
- don't install `date` library and header files
- handle missing 'dat' folder for install step


## [v19.04.1] - 2019-04-06
### Added
- add SecondsInYear function to TimeInfo

### Fixed
- SecondsElapsed is expected to return the absolute difference between TimeInfo objects
- use SecondsInYear function to fix TimeInfo file writing (fixes wrong date displayed after EndOfDay)


## [v19.03.2] - 2019-03-18
### Fixed
- add StringCompare len parameter, fixes "End of Day" behavior and many other bugs


## [19.03.1] - 2019-03-08
### Changed
- disable auto updater of `vt_main`
- print finalized check receipe also in training mode

### Fixed
- segfault because of `input_id` narrowing conversion
- unhandled exception when ConfFile doesn't exist
- don't try to render reports that failed to load
- loader logofile path can be something other than `/usr/viewtouch/graphics/logofile`
- loader CSS deprecation warnings
- regression in StringCompare, old behavior restored (fixes subcheck receipe printing)


## [v19.02.1] - 2019-02-16
### Added
- support for building with clang toolchain

### Fixed
- armhf and arm64 builds by using exact types for read and write operations
- segfault when printing a work order when no printer is configured
- crash on shutdown preventing modifications to interface to be saved


## [v19.01.1] - 2019-01-21
First release after versioning change

